(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[696],{1130:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/getting-started/smart-contract-intro",function(){return r(8266)}])},8266:function(e,s,r){"use strict";r.r(s),r.d(s,{__toc:function(){return c}});var n=r(5893),t=r(2673),l=r(684),o=r(3155);r(9488);var i=r(2643),a=r(2154);let c=[{depth:2,value:"Contract Description",id:"contract-description"},{depth:3,value:"Contract Parameters",id:"contract-parameters"},{depth:3,value:"Reference Input Datum",id:"reference-input-datum"},{depth:3,value:"Contract Datum",id:"contract-datum"},{depth:3,value:"Contract Redeemer",id:"contract-redeemer"},{depth:2,value:"Contract Logic",id:"contract-logic"},{depth:3,value:"Placing a bet",id:"placing-a-bet"},{depth:3,value:"Taking the bet pot",id:"taking-the-bet-pot"}];function h(e){let s=Object.assign({h1:"h1",p:"p",sup:"sup",a:"a",code:"code",h2:"h2",h3:"h3",ul:"ul",li:"li",strong:"strong",pre:"pre",span:"span",ol:"ol",em:"em",section:"section"},(0,i.a)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{children:"Smart Contract"}),"\n",(0,n.jsx)(s.p,{children:"Let's now start by writing a smart contract that we will use to convey framework's important features."}),"\n",(0,n.jsx)(a.UW,{type:"warning",children:(0,n.jsxs)(s.p,{children:["This contract is for illustrative purposes only. We do not recommend using it in a production environment",(0,n.jsx)(s.sup,{children:(0,n.jsx)(s.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})}),"."]})}),"\n",(0,n.jsx)(a.UW,{children:(0,n.jsxs)(s.p,{children:["Here we'll be writing our smart contract in Haskell but do note that we are not limited to it. You for instance could write your smart contract in any language of your choice and read the compiled CBOR using ",(0,n.jsx)(s.code,{children:"scriptFromCBOR"})," function defined ",(0,n.jsx)(s.a,{href:"https://github.com/geniusyield/atlas/tree/main/src/GeniusYield/Types/Script.hs",children:"here"})," (",(0,n.jsx)(s.a,{href:"./operations",children:"Operations over Contract"})," chapter explains about types such as ",(0,n.jsx)(s.code,{children:"GYScript"}),", ",(0,n.jsx)(s.code,{children:"PlutusVersion"})," which are used in this function). Similarly, there is ",(0,n.jsx)(s.code,{children:"readScript"})," defined in the ",(0,n.jsx)(s.a,{href:"https://github.com/geniusyield/atlas/tree/main/src/GeniusYield/Types/Script.hs",children:"same"})," file to read from the compiled ",(0,n.jsx)(s.a,{href:"https://cardano-api.cardano.intersectmbo.org/cardano-api/Cardano-Api-SerialiseTextEnvelope.html#t:TextEnvelope",children:"text envelope"})," file."]})}),"\n",(0,n.jsx)(s.h2,{id:"contract-description",children:"Contract Description"}),"\n",(0,n.jsx)(s.p,{children:"A setting here is that we have a sport match happening and a group of friends want to bet on the number of goals scored by their favorite team in it."}),"\n",(0,n.jsx)(s.p,{children:"Winner is the one whose guess is closest (and in case of tie - the one who takes it fastest!)."}),"\n",(0,n.jsxs)(s.p,{children:["The smart contract code is available ",(0,n.jsx)(s.a,{href:"https://github.com/geniusyield/atlas-examples/tree/main/bet-ref/onchain/BetRef/OnChain/BetRef.hs",children:"here"}),". This example was inspired by ",(0,n.jsx)(s.a,{href:"https://github.com/mlabs-haskell/plutus-simple-model/blob/main/psm/test/Suites/Plutus/Model/Script/V2/Onchain/Oracle.hs",children:"MLabs"}),"."]}),"\n",(0,n.jsx)(a.UW,{type:"info",children:(0,n.jsxs)(s.p,{children:["Since the underlying version of ",(0,n.jsx)(s.code,{children:"plutus"})," library we are using defaults to version 1.1.0 of plutus core, we need to explicitly set ",(0,n.jsx)(s.a,{href:"https://plutus.readthedocs.io/en/latest/reference/writing-scripts/compiler-options.html",children:(0,n.jsx)(s.code,{children:"target-version"})})," to 1.0.0, and that is why there is ",(0,n.jsx)(s.code,{children:"ghc-options: -fplugin-opt PlutusTx.Plugin:target-version=1.0.0"})," in ",(0,n.jsx)(s.a,{href:"https://github.com/geniusyield/atlas-examples/blob/main/bet-ref/betref.cabal",children:"our cabal file"}),"."]})}),"\n",(0,n.jsx)(s.h3,{id:"contract-parameters",children:"Contract Parameters"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"brpOraclePkh :: PubKeyHash"})}),": We'll be using a reference input, and its datum will give us the actual result (the number of goals). Since the reference input UTxO must belong to Oracle, we check it using Oracle's payment public key hash."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"brpBetUntil :: POSIXTime"})}),": Time until which bets can be placed."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"brpBetReveal :: POSIXTime"})}),": Time that the Oracle will reveal the match results."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:(0,n.jsx)(s.code,{children:"brpBetStep :: Value"})}),": Minimum value that bets must increase by."]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"Thus, the parameters of our contract are given by:"}),"\n",(0,n.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",filename:"BetRef.hs",hasCopyCode:!0,children:(0,n.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Our contract is parameterized with this."})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"data"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BetRefParams"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" BetRefParams"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  { brpOraclePkh "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PubKeyHash"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Oracle's payment public key hash. This is needed to assert that UTxO being looked at indeed belongs to the Oracle."})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , brpBetUntil  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"POSIXTime"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Time until which bets can be placed."})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , brpBetReveal "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"POSIXTime"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Time at which Oracle will reveal the correct match result."})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , brpBetStep   "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Value"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Each newly placed bet must be more than previous bet by `brpBetStep` amount."})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"PlutusTx.makeLift ''BetRefParams"})})]})}),"\n",(0,n.jsx)(s.h3,{id:"reference-input-datum",children:"Reference Input Datum"}),"\n",(0,n.jsx)(s.p,{children:"The Oracle tells us the number of goals scored by the concerned team:"}),"\n",(0,n.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",filename:"BetRef.hs",hasCopyCode:!0,children:(0,n.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Goals made my the concerned team."})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TeamGoals"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Integer"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Match result given by the Oracle."})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"newtype"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"OracleAnswerDatum"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" OracleAnswerDatum "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TeamGoals"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"deriving"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"newtype"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Eq"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Show"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"PlutusTx.unstableMakeIsData ''OracleAnswerDatum"})})]})}),"\n",(0,n.jsx)(s.h3,{id:"contract-datum",children:"Contract Datum"}),"\n",(0,n.jsx)(s.p,{children:"It consists of two fields:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsx)(s.p,{children:"List containing each person's guess along with their payment public key hash. Key hash is used to tie guess with the guesser. Every time a new guess is made, we prepend it to this list.\nThis key hash is obtained from transaction signatories - we insist on key hash being present in signatories as otherwise anyone may override bet of someone else."}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:["Amount denoting the previously placed bet. Note that the total value in the UTxO belonging to contract is the culmination of ",(0,n.jsx)(s.strong,{children:"all"})," the previously placed bets and thus it isn't in general equal to last placed bet. We use this to assert that the newly placed bet is more than the previous one by ",(0,n.jsx)(s.code,{children:"brpBetStep"})," amount."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",filename:"BetRef.hs",hasCopyCode:!0,children:(0,n.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | List of guesses by users along with the maximum bet placed yet. A new guess gets /prepended/ to this list. Note that since we are always meant to increment previously placed bet with `brpBetStep`, the newly placed bet would necessarily be maximum (it would be foolish to initialize `brpBetStep` with some negative amounts)."})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"data"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BetRefDatum"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" BetRefDatum"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  { brdBets        "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" [("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PubKeyHash"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"OracleAnswerDatum"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")]"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , brdPreviousBet "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Value"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"PlutusTx.unstableMakeIsData ''BetRefDatum"})})]})}),"\n",(0,n.jsx)(s.h3,{id:"contract-redeemer",children:"Contract Redeemer"}),"\n",(0,n.jsx)(s.p,{children:"There are two actions available to user:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"To place a bet - in which case they give their guess."}),"\n",(0,n.jsx)(s.li,{children:"To take the bets in the pot after the result is out."}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"This is therefore codified as:"}),"\n",(0,n.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",filename:"BetRef.hs",hasCopyCode:!0,children:(0,n.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Redeemer representing choices available to the user."})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"data"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BetRefAction"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" Bet "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!OracleAnswerDatum"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ User makes a guess."})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" Take                    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ User takes the pot."})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"PlutusTx.unstableMakeIsData ''BetRefAction"})})]})}),"\n",(0,n.jsx)(s.h2,{id:"contract-logic",children:"Contract Logic"}),"\n",(0,n.jsx)(s.h3,{id:"placing-a-bet",children:"Placing a bet"}),"\n",(0,n.jsxs)(s.p,{children:["Initial bet gets placed as it is (in Cardano, spending validator script is executed only when spending an UTxO belonging to it but not for creating ",(0,n.jsx)(s.em,{children:"at it"}),")."]}),"\n",(0,n.jsx)(s.p,{children:"For subsequent bets, we require three conditions:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["The bet must be before (inclusive) the ",(0,n.jsx)(s.code,{children:"brpBetUntil"})," time."]}),"\n",(0,n.jsx)(s.li,{children:"There must be exactly one continuing output at the script address whose datum shall have the current guess prepended to it along with the current bet amount."}),"\n",(0,n.jsxs)(s.li,{children:["The current bet must be more than the previous bet by at least ",(0,n.jsx)(s.code,{children:"brpBetStep"})," amount."]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"This is coded as:"}),"\n",(0,n.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",filename:"BetRef.hs",hasCopyCode:!0,children:(0,n.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"{-# "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"INLINABLE"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" mkBetRefValidator' #-}"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Core smart contract logic. Read its description from Atlas guide."})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"mkBetRefValidator'"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BetRefParams"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BetRefDatum"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BetRefAction"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"ScriptContext"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Bool"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"mkBetRefValidator' (BetRefParams oraclePkh betUntil betReveal betStep) (BetRefDatum previousGuesses previousBet) brAction ctx "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" brAction "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    Bet guess  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        sOut "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" getContinuingOutputs ctx "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          [sOut']        "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" sOut'"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          _anyOtherMatch "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" traceError "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Expected only one continuing output."'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        outValue "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txOutValue sOut"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        sIn "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" maybe (traceError "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Could not find own input"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") txInInfoResolved (findOwnInput ctx)"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        inValue "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txOutValue sIn"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        (guessesOut"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" betOut) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" outputToDatum sOut "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          Nothing                                "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" traceError "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Could not resolve for script output datum"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          Just (BetRefDatum guessesOut' betOut') "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (guessesOut'"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" betOut')"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"in"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        traceIfFalse"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Must be before `BetUntil` time"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            (to betUntil "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"`contains`"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" validRange) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        traceIfFalse"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Guesses update is wrong"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            ((signerPkh"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" guess) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" previousGuesses "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" guessesOut) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        traceIfFalse"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"The current bet must be more than the previous bet by atleast `brpBetStep` amount"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            (outValue "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"`geq`"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (inValue "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<>"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" previousBet "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<>"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" betStep)) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        traceIfFalse"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Out bet is wrong"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            (betOut "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" outValue "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" inValue)"})]})]})}),"\n",(0,n.jsx)(s.p,{children:"Where we have the following common helpers for both the redemeer actions:"}),"\n",(0,n.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",filename:"BetRef.hs",hasCopyCode:!0,children:(0,n.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"where"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"info"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TxInfo"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    info "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" scriptContextTxInfo ctx"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"validRange"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"POSIXTimeRange"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    validRange "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txInfoValidRange info"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"signerPkh"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PubKeyHash"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    signerPkh "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txInfoSignatories info "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      [signerPkh']   "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" signerPkh'"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"[]"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"             "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" traceError "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"No signatory"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      _anyOtherMatch "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" traceError "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Expected only one signatory"'})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:" "}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"outputToDatum"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"FromData"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" b "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"TxOut"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Maybe"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" b"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    outputToDatum o "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txOutDatum o "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      NoOutputDatum      "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" Nothing"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      OutputDatum d      "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" processDatum d"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      OutputDatumHash dh "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" processDatum "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=<<"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" findDatum dh info"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"where"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" processDatum "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" fromBuiltinData "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" getDatum"})]})]})}),"\n",(0,n.jsx)(s.h3,{id:"taking-the-bet-pot",children:"Taking the bet pot"}),"\n",(0,n.jsx)(s.p,{children:"In this case we require the following four conditions:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["This operation must occur after (inclusive) ",(0,n.jsx)(s.code,{children:"brpBetReveal"})," time."]}),"\n",(0,n.jsx)(s.li,{children:"The script must get fully spend, i.e., there shouldn't be any continuing outputs to this script address."}),"\n",(0,n.jsx)(s.li,{children:"The reference input whose datum is used to see actual answer should belong to concerned Oracle."}),"\n",(0,n.jsx)(s.li,{children:"Guess should be closest among all."}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"This is therefore coded as:"}),"\n",(0,n.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",filename:"BetRef.hs",hasCopyCode:!0,children:(0,n.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    Take "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        Just guess "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" find (("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" signerPkh) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" fst) previousGuesses  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Note that `find` returns the first match. Since we were always prepending, this is valid."})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        oracleIn "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" filter (isNothing "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"."}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txOutReferenceScript) (txInInfoResolved "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<$>"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" txInfoReferenceInputs info) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          [oracleIn']    "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" oracleIn'"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"[]"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"             "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" traceError "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"No reference input provided"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          _anyOtherMatch "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" traceError "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Expected only one reference input"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        oracleAnswer "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" outputToDatum oracleIn "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          Nothing                                  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" traceError "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Could not resolve for datum"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          (Just (OracleAnswerDatum oracleAnswer')) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" oracleAnswer'"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        guessDiff "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" getGuessDiff "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" snd guess"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        getGuessDiff (OracleAnswerDatum g) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" abs (oracleAnswer "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" g)"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        oracleInPkh "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" toPubKeyHash (txOutAddress oracleIn) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          Nothing  "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" traceError "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Not PKH for oracle address"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          Just pkh "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" pkh"})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"in"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        traceIfFalse"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Must be after `RevealTime`"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            (from betReveal "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"`contains`"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" validRange) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        traceIfFalse"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Must fully spend Script"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            (null (getContinuingOutputs ctx)) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        traceIfFalse"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Reference input must be from Oracle address (wrt Payment part)"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            (oracleInPkh "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" oraclePkh) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"})]}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        traceIfFalse"})}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Guess is not closest"'})]}),"\n",(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            (all ("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"\\"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"pg "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" getGuessDiff (snd pg) "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:">="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" guessDiff) previousGuesses)"})]})]})}),"\n",(0,n.jsx)(s.p,{children:"And lo behold! This is our contract."}),"\n","\n",(0,n.jsxs)(s.section,{"data-footnotes":!0,className:"footnotes",children:[(0,n.jsx)(s.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{id:"user-content-fn-1",children:["\n",(0,n.jsxs)(s.p,{children:["For instance, here we assert that UTxO being used as reference input must belong to Oracle's address but do note that anyone can create an UTxO at Oracle's address. ",(0,n.jsx)(s.a,{href:"#user-content-fnref-1","data-footnote-backref":!0,className:"data-footnote-backref","aria-label":"Back to content",children:"↩"})]}),"\n"]}),"\n"]}),"\n"]})]})}let d={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,i.a)(),e.components);return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(h,{...e})}):h(e)},pageOpts:{filePath:"src/pages/getting-started/smart-contract-intro.mdx",route:"/getting-started/smart-contract-intro",timestamp:1728302619e3,pageMap:[{kind:"Meta",data:{index:{title:"Atlas",display:"hidden",theme:{layout:"raw"}},documentation:{title:"Documentation",type:"page",href:"/introduction"},introduction:"Introduction","getting-started":"Getting Started","additional-features":"Additional Features","more-tutorials":"More Tutorials",haddock:{title:"API Reference (Haddock) ⬈",href:"https://haddock.atlas-app.io/",newWindow:!0}}},{kind:"Folder",name:"additional-features",route:"/additional-features",children:[{kind:"Meta",data:{blueprint:"Blueprint"}},{kind:"MdxPage",name:"blueprint",route:"/additional-features/blueprint"}]},{kind:"Folder",name:"getting-started",route:"/getting-started",children:[{kind:"Meta",data:{"how-to-build":"How to build?","smart-contract-intro":"Smart Contract",operations:"Operations over Contract",testing:"Testing",endpoints:"Creating Endpoints","browser-integration":"Browser Integration","unit-tests":{display:"hidden",title:"Unit Tests"},"integration-tests":{display:"hidden",title:"Integration Tests"}}},{kind:"MdxPage",name:"browser-integration",route:"/getting-started/browser-integration"},{kind:"MdxPage",name:"endpoints",route:"/getting-started/endpoints"},{kind:"MdxPage",name:"how-to-build",route:"/getting-started/how-to-build"},{kind:"MdxPage",name:"integration-tests",route:"/getting-started/integration-tests"},{kind:"MdxPage",name:"operations",route:"/getting-started/operations"},{kind:"MdxPage",name:"smart-contract-intro",route:"/getting-started/smart-contract-intro"},{kind:"MdxPage",name:"testing",route:"/getting-started/testing"},{kind:"MdxPage",name:"unit-tests",route:"/getting-started/unit-tests"}]},{kind:"MdxPage",name:"getting-started",route:"/getting-started"},{kind:"MdxPage",name:"index",route:"/"},{kind:"MdxPage",name:"introduction",route:"/introduction"},{kind:"MdxPage",name:"more-tutorials",route:"/more-tutorials"}],flexsearch:{codeblocks:!0},title:"Smart Contract",headings:c},pageNextRoute:"/getting-started/smart-contract-intro",nextraLayout:l.ZP,themeConfig:o.Z};s.default=(0,t.j)(d)},3155:function(e,s,r){"use strict";r.d(s,{Z:function(){return h}});var n=r(5893);r(7294);var t=r(5675),l=r.n(t),o={src:"/_next/static/media/atlas-logo-light-mode.6077cdd3.svg",height:320,width:937,blurWidth:0,blurHeight:0},i={src:"/_next/static/media/atlas-logo-dark-mode.62b4f6dd.svg",height:320,width:945,blurWidth:0,blurHeight:0},a=r(2010),c=r(1163),h={logo:(0,n.jsx)(()=>{let{resolvedTheme:e}=(0,a.F)();return(0,n.jsx)(l(),{src:"light"===e?o:i,alt:"Atlas Logo",height:"42"})},{}),project:{link:"https://github.com/geniusyield/atlas"},docsRepositoryBase:"https://github.com/geniusyield/atlas-docs/tree/main",useNextSeoProps(){let{asPath:e}=(0,c.useRouter)(),s="All-in-one solution for writing off-chain code for Plutus contracts";return{titleTemplate:"/"===e?"ATLAS Plutus Application Backend | by Genius Yield":"Atlas | %s",description:s,canonical:"https://atlas-app.io",openGraph:{url:"https://atlas-app.io",description:s,images:[{url:"/open-graph.png",width:1200,height:630,alt:"Atlas - Application backend for Plutus smart contracts on Cardano",type:"image/png"}]},siteName:"Atlas",twitter:{handle:"@GeniusyieldO",site:"https://www.geniusyield.co",cardType:"summary_large_image"}}},head:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("link",{rel:"apple-touch-icon",sizes:"180x180",href:"/favicon/apple-touch-icon.png"}),(0,n.jsx)("link",{rel:"icon",type:"image/png",sizes:"32x32",href:"/favicon/favicon-32x32.png"}),(0,n.jsx)("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"/favicon/favicon-16x16.png"}),(0,n.jsx)("link",{rel:"manifest",href:"/favicon/site.webmanifest"}),(0,n.jsx)("link",{rel:"mask-icon",href:"/favicon/safari-pinned-tab.svg",color:"#5bbad5"}),(0,n.jsx)("link",{rel:"shortcut icon",href:"/favicon/favicon.ico"}),(0,n.jsx)("meta",{name:"msapplication-TileColor",content:"#da532c"}),(0,n.jsx)("meta",{name:"msapplication-config",content:"/favicon/browserconfig.xml"}),(0,n.jsx)("meta",{name:"theme-color",content:"#ffffff"})]}),footer:{component:(0,n.jsx)(n.Fragment,{})},nextThemes:{defaultTheme:"dark"},darkMode:!1,sidebar:{toggleButton:!0}}},5789:function(){}},function(e){e.O(0,[901,888,774,179],function(){return e(e.s=1130)}),_N_E=e.O()}]);