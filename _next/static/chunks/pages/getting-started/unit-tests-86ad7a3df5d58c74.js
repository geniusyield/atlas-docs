(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[767],{4589:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/getting-started/unit-tests",function(){return l(3498)}])},3498:function(e,s,l){"use strict";l.r(s),l.d(s,{__toc:function(){return c}});var r=l(5893),o=l(2673),t=l(684),n=l(3155);l(9488);var i=l(2643),a=l(2154);let c=[{depth:2,value:'Why not just use "Plutus simple model" instead of the wrapper?',id:"why-not-just-use-plutus-simple-model-instead-of-the-wrapper"},{depth:2,value:"Unit tests for placing a bet operation",id:"unit-tests-for-placing-a-bet-operation"},{depth:3,value:"Defining Run for placing a bet operation",id:"defining-run-for-placing-a-bet-operation"},{depth:3,value:"Understanding testRun",id:"understanding-testrun"},{depth:3,value:"Defining a trace to call placeBetRun",id:"defining-a-trace-to-call-placebetrun"},{depth:3,value:"Multiple bets trace",id:"multiple-bets-trace"},{depth:3,value:"But sometimes we want a test to fail!",id:"but-sometimes-we-want-a-test-to-fail"},{depth:2,value:"Unit tests for taking the bet pot",id:"unit-tests-for-taking-the-bet-pot"}];function h(e){let s=Object.assign({h1:"h1",p:"p",code:"code",a:"a",sup:"sup",h2:"h2",ol:"ol",li:"li",strong:"strong",ul:"ul",h3:"h3",em:"em",pre:"pre",span:"span",section:"section"},(0,i.a)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{children:"Unit Tests"}),"\n",(0,r.jsxs)(s.p,{children:["Writing smart contracts & writing tests go hand in hand. Tests are also an excellent way to conveniently check working of our smart contract instead of building transactions using ",(0,r.jsx)(s.code,{children:"cardano-cli"})," and submitting them to local node."]}),"\n",(0,r.jsx)(s.p,{children:"Now that we have written our smart contract and defined the required operations over it, let's see whether its working as expected."}),"\n",(0,r.jsxs)(s.p,{children:["Our test suite is a wrapper around ",(0,r.jsx)(s.a,{href:"https://github.com/mlabs-haskell/plutus-simple-model",children:"Plutus simple model"}),(0,r.jsx)(s.sup,{children:(0,r.jsx)(s.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})," which is created by MLabs."]}),"\n",(0,r.jsxs)(a.UW,{type:"warning",children:[(0,r.jsxs)(s.p,{children:["MLabs is working on an evolution of PSM, namely ",(0,r.jsx)(s.a,{href:"https://github.com/mlabs-haskell/clb",children:"CLB"})," which is intended to work exclusively with Atlas. Thus, we have deprecated support of PSM and would soon document overhaul of this test suite. If you would like to avoid using PSM and wait till CLB is ready, you can skip to next section, namely, ",(0,r.jsx)(s.a,{href:"./integration-tests",children:"Integration Tests"}),"."]}),(0,r.jsx)(s.p,{children:"Currently our PSM wrapper does not support operations related to staking, namely, stake key registration, delegation, de-registration and rewards withdrawal."})]}),"\n",(0,r.jsx)(s.h2,{id:"why-not-just-use-plutus-simple-model-instead-of-the-wrapper",children:'Why not just use "Plutus simple model" instead of the wrapper?'}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Reusability"}),": Well firstly to maintain compatibility with our toolchain. For instance, our operations were making use of ",(0,r.jsx)(s.code,{children:"GYTxQueryMonad"})," monad and thus to be able to reuse those same operations we would need to define an instance for it."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Additional checks"}),": But secondly and more importantly, plutus simple model lacks some basic checks, for instance:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Whether a UTxO satisfies minimum ada requirement."}),"\n",(0,r.jsx)(s.li,{children:"Transaction fees requirement."}),"\n",(0,r.jsx)(s.li,{children:"Transaction signatures requirement, etc."}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"We already handle these cases using our transaction building machinery and thus tests written here reflect the actual environment more."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(a.UW,{children:(0,r.jsxs)(s.p,{children:["For this guide there should be no need to go over the plutus simple model documentation but this doesn't mean that one shouldn't. It's very lucid and takes few minutes to cover and can be accessed by cloning ",(0,r.jsx)(s.a,{href:"https://github.com/mlabs-haskell/plutus-simple-model",children:"their"})," repository, entering the ",(0,r.jsx)(s.code,{children:"docs"})," folder and running ",(0,r.jsx)(s.code,{children:"mdbook serve --open"}),"."]})}),"\n",(0,r.jsx)(s.h2,{id:"unit-tests-for-placing-a-bet-operation",children:"Unit tests for placing a bet operation"}),"\n",(0,r.jsx)(a.UW,{type:"warning",emoji:"\uD83D\uDCC3",children:(0,r.jsxs)(s.p,{children:["Entire code file for tests pertaining to this operation is available ",(0,r.jsx)(s.a,{href:"https://github.com/geniusyield/atlas-examples/tree/main/bet-ref/tests/BetRef/Tests/PlaceBet.hs",children:"here"}),". Note that we are using ",(0,r.jsx)(s.a,{href:"https://hackage.haskell.org/package/tasty",children:(0,r.jsx)(s.code,{children:"tasty"})})," to write our tests and a file calling these individual unit tests is ",(0,r.jsx)(s.a,{href:"https://github.com/geniusyield/atlas-examples/tree/main/bet-ref/tests/betref-tests.hs",children:"here"}),"."]})}),"\n",(0,r.jsx)(s.p,{children:'Our objective here would be to write tests for each of our operation, hence the name "unit tests". Though one may write other sort of tests as well, including property based ones.'}),"\n",(0,r.jsxs)(s.h3,{id:"defining-run-for-placing-a-bet-operation",children:["Defining ",(0,r.jsx)(s.em,{children:"Run"})," for placing a bet operation"]}),"\n",(0,r.jsx)(s.p,{children:"Before any jibber-jabber, let's see the code so that we know it isn't as complex as it might seem:"}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"placeBetRun"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxOutRef"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BetRefParams"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"OracleAnswerDatum"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Maybe"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxOutRef"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxMonadRun"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxId"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"placeBetRun refScript brp guess bet mPreviousBetsUtxoRef "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  addr "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ownAddress"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  skeleton "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" placeBet refScript brp guess bet addr mPreviousBetsUtxoRef"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  sendSkeleton skeleton"})})]})}),"\n",(0,r.jsxs)(a.UW,{type:"info",children:[(0,r.jsxs)(s.p,{children:[(0,r.jsxs)(s.strong,{children:['Why do we call it "',(0,r.jsx)(s.em,{children:"run"}),'"?']})," Well if you have gone over the documentation of ",(0,r.jsx)(s.a,{href:"https://github.com/mlabs-haskell/plutus-simple-model",children:"plutus simple model"}),", you'll know that they have this \"",(0,r.jsx)(s.em,{children:"Run"}),'" monad where actually most of the test code gets executed and we have wrapper around this type, which we call ',(0,r.jsx)(s.a,{href:"https://haddock.atlas-app.io/GeniusYield-TxBuilder-Class.html#v:utxoAtTxOutRef",children:(0,r.jsx)(s.code,{children:"GYTxMonadRun"})}),". But as an end developer, there is no need to understand about it."]}),(0,r.jsxs)(s.p,{children:["Also our ",(0,r.jsx)(s.code,{children:"GYTxMonadRun"})," has an instance of ",(0,r.jsx)(s.code,{children:"GYTxQueryMonad"}),"."]})]}),"\n",(0,r.jsxs)(s.p,{children:["The idea here is that any tests we do related to performing the bet operation would need to call the ",(0,r.jsx)(s.code,{children:"placeBet"})," function which we have defined before. Therefore we have defined a ",(0,r.jsx)(s.em,{children:"run"})," to call this function. Our ",(0,r.jsx)(s.code,{children:"placeBetRun"})," function takes all those parameters which are required by ",(0,r.jsx)(s.code,{children:"placeBet"})," function, except the address as that we are able to get using ",(0,r.jsx)(s.code,{children:"ownAddress"})," function",(0,r.jsx)(s.sup,{children:(0,r.jsx)(s.a,{href:"#user-content-fn-2",id:"user-content-fnref-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})}),". ",(0,r.jsx)(s.a,{href:"https://haddock.atlas-app.io/GeniusYield-TxBuilder-Run.html#v:ownAddress",children:(0,r.jsx)(s.code,{children:"ownAddress"})})," function is defined in ",(0,r.jsx)(s.a,{href:"https://haddock.atlas-app.io/GeniusYield-TxBuilder-Run.html",children:(0,r.jsx)(s.code,{children:"GeniusYield.TxBuilder.Run"})})," module where actually most of the code related to our wrapper lives and it gives the address of the wallet running this ",(0,r.jsx)(s.em,{children:"run"})," as we'll shortly see."]}),"\n",(0,r.jsxs)(s.p,{children:["Lastly ",(0,r.jsx)(s.code,{children:"sendSkeleton"})," can be understood as submitting the transaction. It will update the mock ledger state and return the transaction id for the submitted transaction. Note that it does raise an exception in case it fails to submit the transaction."]}),"\n",(0,r.jsxs)(s.h3,{id:"understanding-testrun",children:["Understanding ",(0,r.jsx)(s.code,{children:"testRun"})]}),"\n",(0,r.jsxs)(s.p,{children:["Before we see a trace calling the run we just defined, notice that in our ",(0,r.jsx)(s.code,{children:"testGroup"}),", we have the first test written as:"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsx)(s.code,{"data-language":"haskell","data-theme":"default",children:(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"testRun "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Balance checks after placing first bet"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" firstBetTrace (OracleAnswerDatum "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"3"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") (valueFromLovelace "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"20_000_000"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0_182_793"})]})})}),"\n",(0,r.jsxs)(s.p,{children:["Now what is this ",(0,r.jsx)(s.a,{href:"https://haddock.atlas-app.io/GeniusYield-Test-Utils.html#v:testRun",children:(0,r.jsx)(s.code,{children:"testRun"})}),"?"]}),"\n",(0,r.jsxs)(s.p,{children:["This function takes a string to represent the name of the test and a continuation function (of type ",(0,r.jsx)(s.code,{children:"Wallets -> Run a"}),") and then internally generates wallets to give to our continuation function."]}),"\n",(0,r.jsxs)(s.p,{children:["The type ",(0,r.jsx)(s.code,{children:"Wallets"})," is defined as:"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"data"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallets"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" Wallets"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    { w1 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!Wallet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    , w2 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!Wallet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    , w3 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!Wallet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    , w4 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!Wallet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    , w5 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!Wallet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    , w6 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!Wallet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    , w7 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!Wallet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    , w8 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!Wallet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    , w9 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!Wallet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    } "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"deriving"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Show"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Eq"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Ord"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})}),"\n",(0,r.jsxs)(s.p,{children:["where ",(0,r.jsx)(s.code,{children:"Wallet"})," is:"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"data"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" Wallet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    { walletPaymentSigningKey "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!GYPaymentSigningKey"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    , walletNetworkId         "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!GYNetworkId"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    , walletName              "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"!String"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"deriving"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Show"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Eq"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Ord"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})}),"\n",(0,r.jsxs)(s.p,{children:["Thus our ",(0,r.jsx)(s.code,{children:"testRun"})," function, generates these 9 wallets where each wallet is having the following three assets:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Million ada."}),"\n",(0,r.jsxs)(s.li,{children:["Million ",(0,r.jsx)(s.code,{children:"fakeGold"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Million ",(0,r.jsx)(s.code,{children:"fakeIron"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["where ",(0,r.jsx)(s.code,{children:"fakeGold"})," and ",(0,r.jsx)(s.code,{children:"fakeIron"})," are our two non-native assets."]}),"\n",(0,r.jsxs)(s.p,{children:["Each call to ",(0,r.jsx)(s.code,{children:"testRun"})," (as you can see - we have multiple tests, all beginning with ",(0,r.jsx)(s.code,{children:"testRun"}),") runs the given test with a fresh (new) blockchain ledger state having given the above balances to those 9 wallets."]}),"\n",(0,r.jsxs)(s.p,{children:["In our case, ",(0,r.jsx)(s.code,{children:'"Balance checks after placing first bet"'})," is the name of the test and ",(0,r.jsx)(s.code,{children:"firstBetTrace (OracleAnswerDatum 3) (valueFromLovelace 20_000_000) 0_182_793"})," is our continuation function."]}),"\n",(0,r.jsxs)(s.h3,{id:"defining-a-trace-to-call-placebetrun",children:["Defining a trace to call ",(0,r.jsx)(s.code,{children:"placeBetRun"})]}),"\n",(0,r.jsxs)(s.p,{children:["Now let's see the definition ",(0,r.jsx)(s.code,{children:"firstBetTrace"})," we briefly encountered above:"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Trace for placing the first bet."})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"firstBetTrace"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"OracleAnswerDatum"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Guess"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"              "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Bet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"              "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallets"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Run"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"()"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Our continuation function"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"firstBetTrace dat bet ws"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"Wallets{..} "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- First step: Get the required parameters for initializing our parameterized script and add the corresponding reference script"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  (brp"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" refScript) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" computeParamsAndAddRefScript "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"40"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"100"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (valueFromLovelace "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"200_000_000"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") ws"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  void "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" runWallet w1 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- following operations are ran by first wallet, `w1`"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Second step: Perform the actual run."})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    withWalletBalancesCheckSimple [w1 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" valueNegate bet] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      placeBetRun refScript brp dat bet Nothing"})})]})}),"\n",(0,r.jsxs)(s.p,{children:["Here the last argument is of type ",(0,r.jsx)(s.code,{children:"Wallets"})," as we noted."]}),"\n",(0,r.jsxs)(s.p,{children:["Note that this function starts by calling ",(0,r.jsx)(s.code,{children:"computeParamsAndAddRefScript"}),", therefore let's see about it:"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Function to compute the parameters for the contract and add the corresponding refernce script."})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"computeParamsAndAddRefScript"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Integer"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Bet Until slot"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Integer"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Bet Reveal slot"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Bet step value"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallets"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Run"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BetRefParams"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxOutRef"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Our continuation"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"computeParamsAndAddRefScript betUntil' betReveal' betStep Wallets{..} "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" betUntil "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" slotFromApi (fromInteger betUntil')"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      betReveal "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" slotFromApi (fromInteger betReveal')"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  fmap fromJust "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" runWallet w1 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    betUntilTime "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" slotToBeginTime betUntil"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    betRevealTime "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" slotToBeginTime betReveal"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" brp "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" BetRefParams (pubKeyHashToPlutus "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" walletPubKeyHash w8) (timeToPlutus betUntilTime) (timeToPlutus betRevealTime) (valueToPlutus betStep)  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- let oracle be wallet `w8`."})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    mORef "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" addRefScript (walletAddress w9) (betRefValidator' brp)"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" mORef "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      Nothing        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" fail "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Couldn\'t find index of the Reference Script in outputs"'})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      Just refScript "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" return (brp"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" refScript)"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "})]})}),"\n",(0,r.jsxs)(s.p,{children:["Our first step is to construct the parameter (",(0,r.jsx)(s.code,{children:"BetRefParams"}),") for our parameterized contract. Recall its type is:"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"data"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BetRefParams"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" BetRefParams"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  {"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    brpOraclePkh "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"PubKeyHash"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Oracle's payment public key hash. This is needed to assert that UTxO being looked at indeed belongs to the Oracle."})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , brpBetUntil  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"POSIXTime"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Time until which bets can be placed."})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , brpBetReveal "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"POSIXTime"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Time at which Oracle will reveal the correct match result."})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , brpBetStep   "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Value"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Each newly placed bet must be more than previous bet by `brpBetStep` amount."})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})})]})}),"\n",(0,r.jsxs)(s.p,{children:["For ",(0,r.jsx)(s.code,{children:"brpBetUntil"}),", we choose slot 40 but since plutus works in posix time, we need to enter a monad having an instance of ",(0,r.jsx)(s.code,{children:"GYTxQueryMonad"})," to get posix time from slot and therefore that calculation happens inside ",(0,r.jsx)(s.code,{children:"runWallet w1"}),". Similarly for ",(0,r.jsx)(s.code,{children:"brpBetReveal"})," we chose slot 100."]}),"\n",(0,r.jsx)(a.UW,{type:"info",children:(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.a,{href:"https://haddock.atlas-app.io/GeniusYield-Test-Utils.html#v:runWallet",children:(0,r.jsx)(s.code,{children:"runWallet"})})," is a utility function which enables us to give the environment. Hm.. what environment you ask? Well in general when constructing the transaction from skeleton we need some context, like who is actually submitting this transaction? As we'll need their address to give them the change output. ",(0,r.jsx)(s.code,{children:"runWallet"})," takes as first argument, the wallet to generate context from and then the actual ",(0,r.jsx)(s.em,{children:"run"})," to run against this context."]})}),"\n",(0,r.jsxs)(s.p,{children:["Now coming back to our parameters, for ",(0,r.jsx)(s.code,{children:"brpOraclePkh"})," parameter, we chose that for wallet 8. And we take our step amount to be 200 ada."]}),"\n",(0,r.jsxs)(s.p,{children:["Though it is not required for this operation (where we place the first bet) but since our ",(0,r.jsx)(s.code,{children:"placeBet"})," function is overloaded to accept the subsequent bet case too - we need to give reference to the UTxO containing reference script. For that we have a helper function called ",(0,r.jsx)(s.a,{href:"https://haddock.atlas-app.io/GeniusYield-Test-Utils.html#v:addRefScript",children:(0,r.jsx)(s.code,{children:"addRefScript"})})," which adds the given script at a given address (we chose that for wallet 9) and returns the reference to it (in ",(0,r.jsx)(s.code,{children:"Maybe"}),")."]}),"\n",(0,r.jsxs)(s.p,{children:["Now we are almost done to call our ",(0,r.jsx)(s.em,{children:"run"})," with just one more line to understand."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"withWalletBalancesCheckSimple"})," takes a list of tuple",(0,r.jsx)(s.sup,{children:(0,r.jsx)(s.a,{href:"#user-content-fn-3",id:"user-content-fnref-3","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})})," where the first element of the tuple is the wallet and second element denotes the difference in the wallet's value which we expect after the execution of the operation defined inside its ",(0,r.jsx)(s.code,{children:"do"})," block excluding ada required for transaction fees and to satisfy minimum ada requirements of the generated output",(0,r.jsx)(s.sup,{children:(0,r.jsx)(s.a,{href:"#user-content-fn-4",id:"user-content-fnref-4","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"4"})}),". Here we want the balance of wallet 1 (which is the one actually calling this operation) to decrease by the bet amount and also the fees."]}),"\n",(0,r.jsx)(a.UW,{children:(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"How do we know the fees?"}),"\nWell by running the test without it and then noting the transaction fees from the log messages."]})}),"\n",(0,r.jsx)(s.p,{children:"And this covers our first test \uD83E\uDD73."}),"\n",(0,r.jsx)(s.h3,{id:"multiple-bets-trace",children:"Multiple bets trace"}),"\n",(0,r.jsx)(s.p,{children:"Now let's write a slightly more involved trace. This time we'll make our trace parameteric over the required contract parameters."}),"\n",(0,r.jsx)(s.p,{children:"Here is the signature of our trace:"}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Trace which allows for multiple bets."})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"multipleBetsTraceWrapper"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Integer"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                            "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ slot for betUntil"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Integer"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                            "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ slot for betReveal"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                            "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ bet step"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" [("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallets"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"OracleAnswerDatum"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")]  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ List denoting the bets"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallets"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Run"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"()"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Our continuation function"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"multipleBetsTraceWrapper betUntil' betReveal' betStep walletBets ws "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- First step: Get the required parameters for initializing our parameterized script and add the corresponding reference script"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  (brp"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" refScript) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" computeParamsAndAddRefScript betUntil' betReveal' betStep ws"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Second step: Perform the actual bet operations"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  multipleBetsTraceCore brp refScript walletBets ws"})})]})}),"\n",(0,r.jsx)(s.p,{children:"The first three parameters correspond to the parameters of contract."}),"\n",(0,r.jsx)(s.p,{children:"The fourth parameter denotes the different bets."}),"\n",(0,r.jsx)(s.p,{children:"We may for instance call this function like so:"}),"\n",(0,r.jsx)(s.pre,{"data-language":"text","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"text","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'testRun "Balance checks with multiple bets" $ multipleBetsTraceWrapper 400 1000 (valueFromLovelace 10_000_000) '})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  [ (w1, OracleAnswerDatum 1, valueFromLovelace 10_000_000)"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , (w2, OracleAnswerDatum 2, valueFromLovelace 20_000_000)"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , (w3, OracleAnswerDatum 3, valueFromLovelace 30_000_000)"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , (w2, OracleAnswerDatum 4, valueFromLovelace 50_000_000)"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , (w4, OracleAnswerDatum 5, valueFromLovelace 65_000_000 <> fakeGold 1000)"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  ]"})})]})}),"\n",(0,r.jsx)(s.p,{children:"Next we want to add our reference script and compute the actual contract parameters (converting slot to posix) - which is again handled like before."}),"\n",(0,r.jsx)(s.p,{children:"We would then like to perform the actual bet operations. But this time we won't concern ourselves much with actual fees but rather take a threshold of 1 ada. Our approach here is to compare the balances before performaing any operation and after performing all the operations and then see that each wallet has lost the bet amount they placed considering threshold fees."}),"\n",(0,r.jsxs)(s.p,{children:["Note: We use ",(0,r.jsx)(s.code,{children:"balance"})," function to get the balance for the given wallet."]}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Trace which allows for multiple bets."})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"multipleBetsTraceCore"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BetRefParams"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxOutRef"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                         "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Reference script"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" [("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallets"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"OracleAnswerDatum"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")]  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ List denoting the bets"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallets"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Run"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"()"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Our continuation function"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"multipleBetsTraceCore brp refScript walletBets ws"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"Wallets{..} "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"      -- | Perform the actual bet operation by the corresponding wallet."})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      performBetOperations "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"[]"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" _ "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" return "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"()"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      performBetOperations ((getWallet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" dat"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" bet) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" remWalletBets) isFirst "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" isFirst "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"then"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          void "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" runWallet (getWallet ws) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            void "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" placeBetRun refScript brp dat bet Nothing"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          performBetOperations remWalletBets False"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- need to get previous bet utxo"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          void "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" runWallet (getWallet ws) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            betRefAddr "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" betRefAddress brp"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            [_scriptUtxo"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"GYUTxO {utxoRef}] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" utxosToList "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<$>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" utxosAtAddress betRefAddr"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            void "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" placeBetRun refScript brp dat bet (Just utxoRef)"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          performBetOperations remWalletBets False"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"      -- | To sum the bet amount for the corresponding wallet."})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      sumWalletBets _wallet "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"[]"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" acc "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" acc"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      sumWalletBets wallet ((getWallet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" _dat"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" bet) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" remWalletBets) acc "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" sumWalletBets wallet remWalletBets ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" getWallet ws "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" wallet "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"then"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" acc "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" valueNegate bet "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" acc)"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"      -- | Idea here is that for each wallet, we want to know how much has been bet. If we encounter a new wallet, i.e., wallet for whose we haven't yet computed value lost, we call `sumWalletBets` on it."})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      getBalanceDiff "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"[]"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" _set acc "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" acc"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      getBalanceDiff wlBets"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"((getWallet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" _dat"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" _bet) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" remWalletBets) set acc "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" wallet "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" getWallet ws"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            wallet'sName "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" walletName wallet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"in"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" Set.member wallet'sName set "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"then"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" getBalanceDiff remWalletBets set acc"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"           getBalanceDiff remWalletBets (Set.insert wallet'sName set) ((wallet "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" sumWalletBets wallet wlBets mempty) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" acc)"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      balanceDiffWithoutFees "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" getBalanceDiff walletBets Set.empty "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"[]"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  balanceBeforeAllTheseOps "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" fmap fromJust "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" runWallet w1 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" traverse ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"\\"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(wallet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" _value) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" balance wallet) balanceDiffWithoutFees"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  performBetOperations walletBets True"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  balanceAfterAllTheseOps "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" fmap fromJust "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" runWallet w1 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" traverse ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"\\"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(wallet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" _value) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" balance wallet) balanceDiffWithoutFees"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  void "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" runWallet w1 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" verify (zip3 balanceDiffWithoutFees balanceBeforeAllTheseOps balanceAfterAllTheseOps)"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"where"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"    -- | Function to verify that the wallet indeed lost by /roughly/ the bet amount. We say /roughly/ as fees is assumed to be within (0, 1 ada]."})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    verify "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"[]"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" return "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"()"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    verify (((wallet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" diff)"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" vBefore"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" vAfter) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" xs) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" vAfterWithoutFees "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" vBefore "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" diff"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          (expectedAdaWithoutFees"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" expectedOtherAssets) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" valueSplitAda vAfterWithoutFees"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          (actualAda"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" actualOtherAssets) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" valueSplitAda vAfter"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- threshold = valueFromLovelace 1_000_000  -- 1 ada"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          threshold "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1_000_000"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- 1 ada"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"in"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" expectedOtherAssets "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" actualOtherAssets "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" actualAda "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" expectedAdaWithoutFees "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" expectedAdaWithoutFees "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" threshold "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" actualAda "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"then"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" verify xs"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"             "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- valueGreater vAfterWithoutFees vAfter && valueGreaterOrEqual vAfter (valueMinus vAfterWithoutFees threshold) then verify xs"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"         "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" fail ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"For wallet "'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" walletName wallet "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'" expected value (without fees) "'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" show vAfterWithoutFees "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'" but actual is "'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" show vAfter)"})]})]})}),"\n",(0,r.jsxs)(a.UW,{children:[(0,r.jsxs)(s.p,{children:["An eagle eye might notice two comments inside the ",(0,r.jsx)(s.code,{children:"verify"})," function."]}),(0,r.jsxs)(s.p,{children:["Firstly, note that ",(0,r.jsx)(s.code,{children:"valueSplitAda"})," splits our ",(0,r.jsx)(s.code,{children:"GYValue"})," into lovelaces and that which remains besides it. Since fees don't affect non-ada tokens (not yet), we compare with respect to threshold using ada tokens."]}),(0,r.jsxs)(s.p,{children:["We could also compare ",(0,r.jsx)(s.code,{children:"GYValue"}),"'s directly using ",(0,r.jsx)(s.code,{children:"valueGreater"})," (there is also ",(0,r.jsx)(s.code,{children:"valueGreaterOrEqual"}),") as done in comments but the current one is slightly more optimal as we need not compare on non-ada tokens again."]})]}),"\n",(0,r.jsx)(s.h3,{id:"but-sometimes-we-want-a-test-to-fail",children:"But sometimes we want a test to fail!"}),"\n",(0,r.jsxs)(s.p,{children:["What happens if the newly placed bet is not more than atleast ",(0,r.jsx)(s.code,{children:"brpBetStep"})," amount? What happens if the transaction skeleton was somewhat wrong, say we didn't put ",(0,r.jsx)(s.code,{children:"mustBeSignedBy"}),"? What if someone tries to place a bet after ",(0,r.jsx)(s.code,{children:"brpBetUntil"}),"? What if..."]}),"\n",(0,r.jsxs)(s.p,{children:["Well for all such cases, we can assert that a given trace must fail using ",(0,r.jsx)(s.code,{children:"mustFail"})," like:"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"text","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"text","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'testRun "Not adding atleast bet step amount should fail" $ mustFail . multipleBetsTrace 400 1000 (valueFromLovelace 10_000_000) '})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  [ (w1, OracleAnswerDatum 1, valueFromLovelace 10_000_000)"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , (w2, OracleAnswerDatum 2, valueFromLovelace 20_000_000)"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , (w3, OracleAnswerDatum 3, valueFromLovelace 30_000_000)"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , (w2, OracleAnswerDatum 4, valueFromLovelace 50_000_000)"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  , (w4, OracleAnswerDatum 5, valueFromLovelace 55_000_000 <> fakeGold 1000)]"})})]})}),"\n",(0,r.jsxs)(s.p,{children:["Here wallet ",(0,r.jsx)(s.code,{children:"w4"})," didn't increase the bet by 10 ada and thus must fail."]}),"\n",(0,r.jsx)(a.UW,{children:(0,r.jsxs)(s.p,{children:["Sometimes we want to assert specific failure among other possible failures. As ",(0,r.jsx)(s.code,{children:"mustFail"})," above doesn't distinguish among them, one can simply use ",(0,r.jsx)(s.code,{children:"catchError"})," like in ",(0,r.jsx)(s.a,{href:"https://github.com/geniusyield/atlas/tree/main/tests/GeniusYield/Test/RefInput.hs",children:"this"})," test."]})}),"\n",(0,r.jsx)(s.h2,{id:"unit-tests-for-taking-the-bet-pot",children:"Unit tests for taking the bet pot"}),"\n",(0,r.jsx)(a.UW,{type:"warning",emoji:"\uD83D\uDCC3",children:(0,r.jsxs)(s.p,{children:["Entire code file for tests pertaining to this operation is available ",(0,r.jsx)(s.a,{href:"https://github.com/geniusyield/atlas-examples/tree/main/bet-ref/tests/BetRef/Tests/TakeBetPot.hs",children:"here"}),"."]})}),"\n",(0,r.jsxs)(s.p,{children:["On similar lines as before, let's first define our ",(0,r.jsx)(s.em,{children:"run"})," for ",(0,r.jsx)(s.code,{children:"takeBets"})," operation:"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Run to call the `takeBets` operation."})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"takeBetsRun"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxOutRef"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BetRefParams"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxOutRef"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxOutRef"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxMonadRun"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxId"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"takeBetsRun refScript brp toConsume refInput "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  addr "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ownAddress"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  skeleton "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" takeBets refScript brp toConsume addr refInput"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  sendSkeleton skeleton"})})]})}),"\n",(0,r.jsxs)(s.p,{children:["Next, we'll define our trace to call this ",(0,r.jsx)(s.em,{children:"run"}),":"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Trace for taking bet pot."})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"takeBetsTrace"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Integer"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                            "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ slot for betUntil"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"              "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Integer"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                            "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ slot for betReveal"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"              "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                            "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ bet step"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"              "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" [("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallets"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"OracleAnswerDatum"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")]  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ List denoting the bets"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"              "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Integer"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                            "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Actual answer"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"              "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallets"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")                                "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Taker"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"              "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Bool"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                                               "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ To check balance"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"              "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Wallets"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Run"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"()"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Our continuation function"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"takeBetsTrace betUntil' betReveal' betStep walletBets answer getTaker toCheckBalance ws"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"Wallets{..} "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  (brp"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" refScript) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" computeParamsAndAddRefScript betUntil' betReveal' betStep ws"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  multipleBetsTraceCore brp refScript walletBets ws"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- Now lets take the bet"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  mMRef "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" runWallet w1 "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" addRefInput True (walletAddress w8) (datumFromPlutusData "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" OracleAnswerDatum answer)"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" taker "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" getTaker ws"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"case"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" mMRef "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"of"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    Just (Just refInput) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      void "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" runWallet taker "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        betRefAddr "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" betRefAddress brp"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        [_scriptUtxo"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"GYUTxO {utxoRef, utxoValue}] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<-"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" utxosToList "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"<$>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" utxosAtAddress betRefAddr Nothing"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        waitUntilSlot "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" slotFromApi (fromInteger betReveal')"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" toCheckBalance "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"then"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" withWalletBalancesCheckSimple [taker "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" utxoValue] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"do"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            takeBetsRun refScript brp utxoRef refInput "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"else"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" takeBetsRun refScript brp utxoRef refInput)"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    _anyOtherMatch "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" fail "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Couldn\'t place reference input successfully"'})]})]})}),"\n",(0,r.jsx)(s.p,{children:"Here we first did the common step of computing the required script parameters and adding the reference script."}),"\n",(0,r.jsxs)(s.p,{children:["Then we used ",(0,r.jsx)(s.a,{href:"https://haddock.atlas-app.io/GeniusYield-Test-Utils.html#v:addRefInput",children:(0,r.jsx)(s.code,{children:"addRefInput"})})," whose purpose here would become clear by seeing its haddock documentation below:"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- | Adds an input (whose datum we'll refer later) and returns the reference to it."})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"addRefInput"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Bool"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Whether to inline this datum?"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"           "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYAddress"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Where to place this output?"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"           "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYDatum"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"-- ^ Our datum."})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"           "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxMonadRun"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"Maybe"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"GYTxOutRef"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})]})}),"\n",(0,r.jsx)(s.p,{children:"Next we simply wait until time for bet revealation and claim our pot!"}),"\n",(0,r.jsxs)(s.p,{children:["Now that we have our trace for taking bet pot, we can try testing for other conditions - examples for some are written in the ",(0,r.jsx)(s.a,{href:"https://github.com/geniusyield/atlas-examples/tree/main/bet-ref/tests/BetRef/Tests/TakeBetPot.hs",children:(0,r.jsx)(s.code,{children:"TakeBetPot.hs"})})," file."]}),"\n","\n",(0,r.jsxs)(s.section,{"data-footnotes":!0,className:"footnotes",children:[(0,r.jsx)(s.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{id:"user-content-fn-1",children:["\n",(0,r.jsxs)(s.p,{children:["We use a ",(0,r.jsx)(s.a,{href:"https://github.com/geniusyield/plutus-simple-model/tree/compat",children:"custom fork"})," of Plutus simple model. ",(0,r.jsx)(s.a,{href:"#user-content-fnref-1","data-footnote-backref":!0,className:"data-footnote-backref","aria-label":"Back to content",children:"↩"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{id:"user-content-fn-2",children:["\n",(0,r.jsxs)(s.p,{children:["To convey the message better, we have a defined ",(0,r.jsx)(s.a,{href:"https://haddock.atlas-app.io/GeniusYield-Test-Utils.html#v::-61-",children:(0,r.jsx)(s.code,{children:"(:=)"})})," pattern synonym:"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"haskell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"haskell","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"pattern"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (:=) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"::"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" x "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" y "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (x"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" y)"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"pattern"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:":="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") x y "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (x"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" y)"})]})]})}),"\n",(0,r.jsx)(s.a,{href:"#user-content-fnref-2","data-footnote-backref":!0,className:"data-footnote-backref","aria-label":"Back to content",children:"↩"}),"\n"]}),"\n",(0,r.jsxs)(s.li,{id:"user-content-fn-3",children:["\n",(0,r.jsxs)(s.p,{children:["Since we require the signature being present in the skeleton, we can't place bet on anyone else's behalf anyways. ",(0,r.jsx)(s.a,{href:"#user-content-fnref-3","data-footnote-backref":!0,className:"data-footnote-backref","aria-label":"Back to content",children:"↩"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{id:"user-content-fn-4",children:["\n",(0,r.jsxs)(s.p,{children:["If you would like exact fine grained control over balance change, use ",(0,r.jsx)(s.code,{children:"withWalletBalancesCheck"})," instead. ",(0,r.jsx)(s.a,{href:"#user-content-fnref-4","data-footnote-backref":!0,className:"data-footnote-backref","aria-label":"Back to content",children:"↩"})]}),"\n"]}),"\n"]}),"\n"]})]})}let d={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,i.a)(),e.components);return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(h,{...e})}):h(e)},pageOpts:{filePath:"src/pages/getting-started/unit-tests.mdx",route:"/getting-started/unit-tests",timestamp:1728128412e3,pageMap:[{kind:"Meta",data:{index:{title:"Atlas",display:"hidden",theme:{layout:"raw"}},documentation:{title:"Documentation",type:"page",href:"/introduction"},introduction:"Introduction","getting-started":"Getting Started","more-tutorials":"More Tutorials",haddock:{title:"API Reference (Haddock) ⬈",href:"https://haddock.atlas-app.io/",newWindow:!0}}},{kind:"Folder",name:"getting-started",route:"/getting-started",children:[{kind:"Meta",data:{"how-to-build":"How to build?","smart-contract-intro":"Smart Contract",operations:"Operations over Contract",testing:"Testing",endpoints:"Creating Endpoints","browser-integration":"Browser Integration","integration-tests":"Integration Tests","unit-tests":"Unit Tests"}},{kind:"MdxPage",name:"browser-integration",route:"/getting-started/browser-integration"},{kind:"MdxPage",name:"endpoints",route:"/getting-started/endpoints"},{kind:"MdxPage",name:"how-to-build",route:"/getting-started/how-to-build"},{kind:"MdxPage",name:"integration-tests",route:"/getting-started/integration-tests"},{kind:"MdxPage",name:"operations",route:"/getting-started/operations"},{kind:"MdxPage",name:"smart-contract-intro",route:"/getting-started/smart-contract-intro"},{kind:"MdxPage",name:"testing",route:"/getting-started/testing"},{kind:"MdxPage",name:"unit-tests",route:"/getting-started/unit-tests"}]},{kind:"MdxPage",name:"getting-started",route:"/getting-started"},{kind:"MdxPage",name:"index",route:"/"},{kind:"MdxPage",name:"introduction",route:"/introduction"},{kind:"MdxPage",name:"more-tutorials",route:"/more-tutorials"}],flexsearch:{codeblocks:!0},title:"Unit Tests",headings:c},pageNextRoute:"/getting-started/unit-tests",nextraLayout:t.ZP,themeConfig:n.Z};s.default=(0,o.j)(d)},3155:function(e,s,l){"use strict";l.d(s,{Z:function(){return h}});var r=l(5893);l(7294);var o=l(5675),t=l.n(o),n={src:"/_next/static/media/atlas-logo-light-mode.6077cdd3.svg",height:320,width:937,blurWidth:0,blurHeight:0},i={src:"/_next/static/media/atlas-logo-dark-mode.62b4f6dd.svg",height:320,width:945,blurWidth:0,blurHeight:0},a=l(2010),c=l(1163),h={logo:(0,r.jsx)(()=>{let{resolvedTheme:e}=(0,a.F)();return(0,r.jsx)(t(),{src:"light"===e?n:i,alt:"Atlas Logo",height:"42"})},{}),project:{link:"https://github.com/geniusyield/atlas"},docsRepositoryBase:"https://github.com/geniusyield/atlas-docs/tree/main",useNextSeoProps(){let{asPath:e}=(0,c.useRouter)(),s="All-in-one solution for writing off-chain code for Plutus contracts";return{titleTemplate:"/"===e?"ATLAS Plutus Application Backend | by Genius Yield":"Atlas | %s",description:s,canonical:"https://atlas-app.io",openGraph:{url:"https://atlas-app.io",description:s,images:[{url:"/open-graph.png",width:1200,height:630,alt:"Atlas - Application backend for Plutus smart contracts on Cardano",type:"image/png"}]},siteName:"Atlas",twitter:{handle:"@GeniusyieldO",site:"https://www.geniusyield.co",cardType:"summary_large_image"}}},head:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("link",{rel:"apple-touch-icon",sizes:"180x180",href:"/favicon/apple-touch-icon.png"}),(0,r.jsx)("link",{rel:"icon",type:"image/png",sizes:"32x32",href:"/favicon/favicon-32x32.png"}),(0,r.jsx)("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"/favicon/favicon-16x16.png"}),(0,r.jsx)("link",{rel:"manifest",href:"/favicon/site.webmanifest"}),(0,r.jsx)("link",{rel:"mask-icon",href:"/favicon/safari-pinned-tab.svg",color:"#5bbad5"}),(0,r.jsx)("link",{rel:"shortcut icon",href:"/favicon/favicon.ico"}),(0,r.jsx)("meta",{name:"msapplication-TileColor",content:"#da532c"}),(0,r.jsx)("meta",{name:"msapplication-config",content:"/favicon/browserconfig.xml"}),(0,r.jsx)("meta",{name:"theme-color",content:"#ffffff"})]}),footer:{component:(0,r.jsx)(r.Fragment,{})},nextThemes:{defaultTheme:"dark"},darkMode:!1,sidebar:{toggleButton:!0}}},5789:function(){}},function(e){e.O(0,[901,888,774,179],function(){return e(e.s=4589)}),_N_E=e.O()}]);