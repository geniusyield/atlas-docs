<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Atlas | Smart Contract</title><meta name="robots" content="index,follow"/><meta name="description" content="All-in-one solution for writing off-chain code for Plutus contracts"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://www.geniusyield.co"/><meta name="twitter:creator" content="@GeniusyieldO"/><meta property="og:title" content="Atlas | Smart Contract"/><meta property="og:description" content="All-in-one solution for writing off-chain code for Plutus contracts"/><meta property="og:url" content="https://atlas-app.io"/><meta property="og:image" content="/open-graph.png"/><meta property="og:image:alt" content="Atlas - Application backend for Plutus smart contracts on Cardano"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><link rel="canonical" href="https://atlas-app.io"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/><style>
        :root {
          --nextra-primary-hue: 212deg;
          --nextra-primary-saturation: 100%;
          --nextra-navbar-height: 4rem;
          --nextra-menu-height: 3.75rem;
          --nextra-banner-height: 2.5rem;
        }
        
        .dark {
          --nextra-primary-hue: 204deg;
          --nextra-primary-saturation: 100%;
        }
      </style><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#ffffff"/><meta name="next-head-count" content="27"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/2e27e0463af74fb7.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2e27e0463af74fb7.css" data-n-g=""/><link rel="preload" href="/_next/static/css/445c4173ffc2bf04.css" as="style"/><link rel="stylesheet" href="/_next/static/css/445c4173ffc2bf04.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer=""></script><script src="/_next/static/chunks/framework-49c6cecf1f6d5795.js" defer=""></script><script src="/_next/static/chunks/main-9f5a69a7cc5beb93.js" defer=""></script><script src="/_next/static/chunks/pages/_app-21b4e5872f65a09f.js" defer=""></script><script src="/_next/static/chunks/526-a4861a08beef6006.js" defer=""></script><script src="/_next/static/chunks/pages/getting-started/smart-contract-intro-6deec4945e1dadf0.js" defer=""></script><script src="/_next/static/ujomVUVsBD45hndN6r9Ly/_buildManifest.js" defer=""></script><script src="/_next/static/ujomVUVsBD45hndN6r9Ly/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&false)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}else{c.add('dark')}if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'dark'}catch(e){}}()</script><div dir="ltr"><script>document.documentElement.setAttribute('dir','ltr')</script><div class="nextra-nav-container nx-sticky nx-top-0 nx-z-20 nx-w-full nx-bg-transparent print:nx-hidden"><div class="nextra-nav-container-blur nx-pointer-events-none nx-absolute nx-z-[-1] nx-h-full nx-w-full nx-bg-white dark:nx-bg-dark nx-shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] dark:nx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:nx-shadow-[0_0_0_1px_#000] contrast-more:dark:nx-shadow-[0_0_0_1px_#fff]"></div><nav class="nx-mx-auto nx-flex nx-h-[var(--nextra-navbar-height)] nx-max-w-[90rem] nx-items-center nx-justify-end nx-gap-2 nx-pl-[max(env(safe-area-inset-left),1.5rem)] nx-pr-[max(env(safe-area-inset-right),1.5rem)]"><a class="nx-flex nx-items-center hover:nx-opacity-75 ltr:nx-mr-auto rtl:nx-ml-auto" href="/"><img alt="Atlas Logo" loading="lazy" width="124" height="42" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/atlas-logo-dark-mode.62b4f6dd.svg"/></a><a class="nx-text-sm contrast-more:nx-text-gray-700 contrast-more:dark:nx-text-gray-100 nx-relative -nx-ml-2 nx-hidden nx-whitespace-nowrap nx-p-2 md:nx-inline-block nx-font-medium nx-subpixel-antialiased" aria-current="true" href="/introduction"><span class="nx-absolute nx-inset-x-0 nx-text-center">Documentation</span><span class="nx-invisible nx-font-medium">Documentation</span></a><div class="nextra-search nx-relative md:nx-w-64 nx-hidden md:nx-inline-block mx-min-w-[200px]"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div><a href="https://github.com/geniusyield/atlas" target="_blank" rel="noreferrer" class="nx-p-2 nx-text-current"><svg width="24" height="24" fill="currentColor" viewBox="3 3 18 18"><title>GitHub</title><path d="M12 3C7.0275 3 3 7.12937 3 12.2276C3 16.3109 5.57625 19.7597 9.15374 20.9824C9.60374 21.0631 9.77249 20.7863 9.77249 20.5441C9.77249 20.3249 9.76125 19.5982 9.76125 18.8254C7.5 19.2522 6.915 18.2602 6.735 17.7412C6.63375 17.4759 6.19499 16.6569 5.8125 16.4378C5.4975 16.2647 5.0475 15.838 5.80124 15.8264C6.51 15.8149 7.01625 16.4954 7.18499 16.7723C7.99499 18.1679 9.28875 17.7758 9.80625 17.5335C9.885 16.9337 10.1212 16.53 10.38 16.2993C8.3775 16.0687 6.285 15.2728 6.285 11.7432C6.285 10.7397 6.63375 9.9092 7.20749 9.26326C7.1175 9.03257 6.8025 8.08674 7.2975 6.81794C7.2975 6.81794 8.05125 6.57571 9.77249 7.76377C10.4925 7.55615 11.2575 7.45234 12.0225 7.45234C12.7875 7.45234 13.5525 7.55615 14.2725 7.76377C15.9937 6.56418 16.7475 6.81794 16.7475 6.81794C17.2424 8.08674 16.9275 9.03257 16.8375 9.26326C17.4113 9.9092 17.76 10.7281 17.76 11.7432C17.76 15.2843 15.6563 16.0687 13.6537 16.2993C13.98 16.5877 14.2613 17.1414 14.2613 18.0065C14.2613 19.2407 14.25 20.2326 14.25 20.5441C14.25 20.7863 14.4188 21.0746 14.8688 20.9824C16.6554 20.364 18.2079 19.1866 19.3078 17.6162C20.4077 16.0457 20.9995 14.1611 21 12.2276C21 7.12937 16.9725 3 12 3Z"></path></svg><span class="nx-sr-only">GitHub</span><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a><button type="button" aria-label="Menu" class="nextra-hamburger -nx-mr-2 nx-rounded nx-p-2 active:nx-bg-gray-400/20 md:nx-hidden"><svg fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" class=""><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16"></path></g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16"></path><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 18h16"></path></g></svg></button></nav></div><div class="nx-mx-auto nx-flex nx-max-w-[90rem]"><div class="motion-reduce:nx-transition-none [transition:background-color_1.5s_ease] nx-bg-transparent"></div><aside class="nextra-sidebar-container nx-flex nx-flex-col md:nx-top-16 md:nx-shrink-0 motion-reduce:nx-transform-none nx-transform-gpu nx-transition-all nx-ease-in-out print:nx-hidden md:nx-w-64 md:nx-sticky md:nx-self-start max-md:[transform:translate3d(0,-100%,0)]"><div class="nx-px-4 nx-pt-4 md:nx-hidden"><div class="nextra-search nx-relative md:nx-w-64"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div></div><div class="nx-overflow-y-auto nx-overflow-x-hidden nx-p-4 nx-grow md:nx-h-[calc(100vh-var(--nextra-navbar-height)-var(--nextra-menu-height))] nextra-scrollbar"><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100"><ul class="nx-flex nx-flex-col nx-gap-1 nextra-menu-desktop max-md:nx-hidden"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/introduction">Introduction</a></li><li class="open"><a class="nx-items-center nx-justify-between nx-gap-2 nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started">Getting Started<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-h-[18px] nx-min-w-[18px] nx-rounded-sm nx-p-0.5 hover:nx-bg-gray-800/5 dark:hover:nx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="nx-origin-center nx-transition-transform rtl:-nx-rotate-180 ltr:nx-rotate-90 rtl:nx-rotate-[-270deg]"></path></svg></a><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100 ltr:nx-pr-0 rtl:nx-pl-0 nx-pt-1"><ul class="nx-flex nx-flex-col nx-gap-1 nx-relative before:nx-absolute before:nx-inset-y-1 before:nx-w-px before:nx-bg-gray-200 before:nx-content-[&quot;&quot;] dark:before:nx-bg-neutral-800 ltr:nx-pl-3 ltr:before:nx-left-0 rtl:nx-pr-3 rtl:before:nx-right-0 ltr:nx-ml-3 rtl:nx-mr-3"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started/how-to-build">How to build?</a></li><li class="nx-flex nx-flex-col nx-gap-1 active"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-bg-primary-100 nx-font-semibold nx-text-primary-800 dark:nx-bg-primary-400/10 dark:nx-text-primary-600 contrast-more:nx-border-primary-500 contrast-more:dark:nx-border-primary-500" href="/getting-started/smart-contract-intro">Smart Contract</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started/operations">Operations over Contract</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started/testing">Testing</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started/endpoints">Creating Endpoints</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started/browser-integration">Browser Integration</a></li></ul></div></div></li><li class="open"><button class="nx-items-center nx-justify-between nx-gap-2 nx-text-left nx-w-full nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">Additional Features<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-h-[18px] nx-min-w-[18px] nx-rounded-sm nx-p-0.5 hover:nx-bg-gray-800/5 dark:hover:nx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="nx-origin-center nx-transition-transform rtl:-nx-rotate-180 ltr:nx-rotate-90 rtl:nx-rotate-[-270deg]"></path></svg></button><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100 ltr:nx-pr-0 rtl:nx-pl-0 nx-pt-1"><ul class="nx-flex nx-flex-col nx-gap-1 nx-relative before:nx-absolute before:nx-inset-y-1 before:nx-w-px before:nx-bg-gray-200 before:nx-content-[&quot;&quot;] dark:before:nx-bg-neutral-800 ltr:nx-pl-3 ltr:before:nx-left-0 rtl:nx-pr-3 rtl:before:nx-right-0 ltr:nx-ml-3 rtl:nx-mr-3"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/additional-features/blueprint">Blueprint</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/additional-features/simple-scripts">Simple Scripts</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/additional-features/monad-io">Provide MonadIO instances</a></li></ul></div></div></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/more-tutorials">More Tutorials</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a href="https://haddock.atlas-app.io/" target="_blank" rel="noreferrer" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">API Reference (Haddock) ⬈<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li></ul></div></div></div><div class="nx-sticky nx-bottom-0 nx-bg-white dark:nx-bg-dark nx-mx-4 nx-py-4 nx-shadow-[0_-12px_16px_#fff] nx-flex nx-items-center nx-gap-2 dark:nx-border-neutral-800 dark:nx-shadow-[0_-12px_16px_#111] contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-shadow-none nx-border-t" data-toggle-animation="off"><button title="Hide sidebar" class="max-md:nx-hidden nx-h-7 nx-rounded-md nx-transition-colors nx-text-gray-600 dark:nx-text-gray-400 nx-px-2 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50"><svg height="12" width="12" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M4.177 7.823l2.396-2.396A.25.25 0 017 5.604v4.792a.25.25 0 01-.427.177L4.177 8.177a.25.25 0 010-.354z" class=""></path><path fill-rule="evenodd" d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0114.25 16H1.75A1.75 1.75 0 010 14.25V1.75zm1.75-.25a.25.25 0 00-.25.25v12.5c0 .138.112.25.25.25H9.5v-13H1.75zm12.5 13H11v-13h3.25a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25z"></path></svg></button></div></aside><nav class="nextra-toc nx-order-last nx-hidden nx-w-64 nx-shrink-0 xl:nx-block print:nx-hidden nx-px-4" aria-label="table of contents"><div class="nextra-scrollbar nx-sticky nx-top-16 nx-overflow-y-auto nx-pr-4 nx-pt-6 nx-text-sm [hyphens:auto] nx-max-h-[calc(100vh-var(--nextra-navbar-height)-env(safe-area-inset-bottom))] ltr:-nx-mr-4 rtl:-nx-ml-4"><p class="nx-mb-4 nx-font-semibold nx-tracking-tight">On This Page</p><ul><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#contract-description" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Contract Description</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#contract-parameters" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Contract Parameters</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#reference-input-datum" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Reference Input Datum</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#contract-datum" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Contract Datum</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#contract-redeemer" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Contract Redeemer</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#contract-logic" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Contract Logic</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#placing-a-bet" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Placing a bet</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#taking-the-bet-pot" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Taking the bet pot</a></li></ul><div class="nx-mt-8 nx-border-t nx-bg-white nx-pt-8 nx-shadow-[0_-12px_16px_white] dark:nx-bg-dark dark:nx-shadow-[0_-12px_16px_#111] nx-sticky nx-bottom-0 nx-flex nx-flex-col nx-items-start nx-gap-2 nx-pb-8 dark:nx-border-neutral-800 contrast-more:nx-border-t contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-border-neutral-400"><a href="https://github.com/geniusyield/atlas-docs/issues/new?title=Feedback%20for%20%E2%80%9CSmart%20Contract%E2%80%9D&amp;labels=feedback" target="_blank" rel="noreferrer" class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50">Question? Give us feedback →<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a><a class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50" href="https://github.com/geniusyield/atlas-docs/tree/main/src/pages/getting-started/smart-contract-intro.mdx">Edit this page</a></div></div></nav><div id="reach-skip-nav"></div><article class="nx-w-full nx-break-words nextra-content nx-flex nx-min-h-[calc(100vh-var(--nextra-navbar-height))] nx-min-w-0 nx-justify-center nx-pb-8 nx-pr-[calc(env(safe-area-inset-right)-1.5rem)]"><main class="nx-w-full nx-min-w-0 nx-max-w-6xl nx-px-6 nx-pt-4 md:nx-px-12"><div class="nextra-breadcrumb nx-mt-1.5 nx-flex nx-items-center nx-gap-1 nx-overflow-hidden nx-text-sm nx-text-gray-500 dark:nx-text-gray-400 contrast-more:nx-text-current"><div class="nx-whitespace-nowrap nx-transition-colors nx-min-w-[24px] nx-overflow-hidden nx-text-ellipsis hover:nx-text-gray-900 dark:hover:nx-text-gray-100" title="Getting Started"><a href="/getting-started">Getting Started</a></div><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-w-3.5 nx-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg><div class="nx-whitespace-nowrap nx-transition-colors nx-font-medium nx-text-gray-700 contrast-more:nx-font-bold contrast-more:nx-text-current dark:nx-text-gray-100 contrast-more:dark:nx-text-current" title="Smart Contract">Smart Contract</div></div><h1 class="nx-mt-2 nx-text-4xl nx-font-bold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100">Smart Contract</h1>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Let&#x27;s now start by writing a smart contract that we will use to convey framework&#x27;s important features.</p>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-yellow-100 nx-bg-yellow-50 nx-text-yellow-900 dark:nx-border-yellow-200/30 dark:nx-bg-yellow-700/30 dark:nx-text-yellow-200"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;">⚠️</div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">This contract is for illustrative purposes only. We do not recommend using it in a production environment<sup><a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]" id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label" href="/getting-started/smart-contract-intro#user-content-fn-1">1</a></sup>.</p></div></div>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-orange-100 nx-bg-orange-50 nx-text-orange-800 dark:nx-border-orange-400/30 dark:nx-bg-orange-400/20 dark:nx-text-orange-300"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;">💡</div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Here we&#x27;ll be writing our smart contract in Plutus-tx (aka Plinth) but do note that we are not limited to it. If you are using <a href="https://aiken-lang.org/" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">Aiken<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>, check out our <a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]" href="/additional-features/blueprint">Blueprint</a> section to see how easily Aiken validators can be plugged into Atlas, also supporting creation of high level Haskell types corresponding to blueprint schema.</p><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">And in general, one can read the compiled validator&#x27;s CBOR using <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">scriptFromCBOR</code> function defined <a href="https://github.com/geniusyield/atlas/tree/main/src/GeniusYield/Types/Script.hs" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">here<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> (<a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]" href="/getting-started/operations">Operations over Contract</a> chapter explains about types such as <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GYScript</code>, <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">PlutusVersion</code> which are used in this function). Similarly, there is <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">readScript</code> defined in the <a href="https://github.com/geniusyield/atlas/tree/main/src/GeniusYield/Types/Script.hs" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">same<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> file to read from the compiled <a href="https://cardano-api.cardano.intersectmbo.org/cardano-api/Cardano-Api-SerialiseTextEnvelope.html#t:TextEnvelope" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">text envelope<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> file.</p><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Note that if your validator is written in Plutarch, we recommend <a href="https://github.com/geniusyield/ply" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">Ply<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> to read Plutarch compiled scripts. In particular, check out <a href="https://github.com/geniusyield/dex-contracts-api/blob/main/geniusyield-dex-api/src/GeniusYield/Scripts/Common.hs" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">this<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> example where GeniusYield reads it&#x27;s plutarch validators into Atlas.</p></div></div>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-blue-200 nx-bg-blue-100 nx-text-blue-900 dark:nx-border-blue-200/30 dark:nx-bg-blue-900/30 dark:nx-text-blue-200"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20" class="nx-mt-1"><path fill-rule="evenodd" clip-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg></div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Besides Plutus scripts, Atlas also supports Simple scripts. Check out <a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]" href="/additional-features/simple-scripts">Simple Scripts</a> section to learn more!</p></div></div>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Contract Description<a href="#contract-description" id="contract-description" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">A setting here is that we have a sport match happening and a group of friends want to bet on the number of goals scored by their favorite team in it.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Winner is the one whose guess is closest (and in case of tie - the one who takes it fastest!).</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">The smart contract code is available <a href="https://github.com/geniusyield/atlas-examples/tree/main/bet-ref/onchain/BetRef/OnChain/BetRef.hs" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">here<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>. This example was inspired by <a href="https://github.com/mlabs-haskell/plutus-simple-model/blob/main/psm/test/Suites/Plutus/Model/Script/V2/Onchain/Oracle.hs" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">MLabs<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>.</p>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-blue-200 nx-bg-blue-100 nx-text-blue-900 dark:nx-border-blue-200/30 dark:nx-bg-blue-900/30 dark:nx-text-blue-200"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20" class="nx-mt-1"><path fill-rule="evenodd" clip-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg></div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Since the underlying version of <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">plutus</code> library we are using defaults to version 1.1.0 of plutus core, we need to explicitly set <a href="https://plutus.readthedocs.io/en/latest/reference/writing-scripts/compiler-options.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">target-version</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> to 1.0.0 (as this example uses Plutus V2 ledger version, but Atlas also supports Plutus V3), and that is why there is <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">ghc-options: -fplugin-opt PlutusTx.Plugin:target-version=1.0.0</code> in <a href="https://github.com/geniusyield/atlas-examples/blob/main/bet-ref/betref.cabal" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">our cabal file<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>.</p></div></div>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Contract Parameters<a href="#contract-parameters" id="contract-parameters" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpOraclePkh :: PubKeyHash</code></strong>: We&#x27;ll be using a reference input, and its datum will give us the actual result (the number of goals). Since the reference input UTxO must belong to Oracle, we check it using Oracle&#x27;s payment public key hash.</li>
<li class="nx-my-2"><strong><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpBetUntil :: POSIXTime</code></strong>: Time until which bets can be placed.</li>
<li class="nx-my-2"><strong><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpBetReveal :: POSIXTime</code></strong>: Time that the Oracle will reveal the match results.</li>
<li class="nx-my-2"><strong><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpBetStep :: Value</code></strong>: Minimum value that bets must increase by.</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Thus, the parameters of our contract are given by:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><div class="nx-absolute nx-top-0 nx-z-[1] nx-w-full nx-truncate nx-rounded-t-xl nx-bg-primary-700/5 nx-py-2 nx-px-4 nx-text-xs nx-text-gray-700 dark:nx-bg-primary-300/10 dark:nx-text-gray-200">BetRef.hs</div><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-pt-12 nx-pb-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">-- | Our contract is parameterized with this.</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">data</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">BetRefParams</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> BetRefParams</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  { brpOraclePkh </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">PubKeyHash</span><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- ^ Oracle&#x27;s payment public key hash. This is needed to assert that UTxO being looked at indeed belongs to the Oracle.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , brpBetUntil  </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">POSIXTime</span><span style="color:var(--shiki-color-text)">   </span><span style="color:var(--shiki-token-comment)">-- ^ Time until which bets can be placed.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , brpBetReveal </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">POSIXTime</span><span style="color:var(--shiki-color-text)">   </span><span style="color:var(--shiki-token-comment)">-- ^ Time at which Oracle will reveal the correct match result.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , brpBetStep   </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Value</span><span style="color:var(--shiki-color-text)">       </span><span style="color:var(--shiki-token-comment)">-- ^ Each newly placed bet must be more than previous bet by `brpBetStep` amount.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  }</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">PlutusTx.unstableMakeIsData &#x27;&#x27;BetRefParams</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-8"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Reference Input Datum<a href="#reference-input-datum" id="reference-input-datum" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">The Oracle tells us the number of goals scored by the concerned team:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><div class="nx-absolute nx-top-0 nx-z-[1] nx-w-full nx-truncate nx-rounded-t-xl nx-bg-primary-700/5 nx-py-2 nx-px-4 nx-text-xs nx-text-gray-700 dark:nx-bg-primary-300/10 dark:nx-text-gray-200">BetRef.hs</div><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-pt-12 nx-pb-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">-- | Goals made my the concerned team.</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">type</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">TeamGoals</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Integer</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-token-comment)">-- | Match result given by the Oracle.</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">newtype</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">OracleAnswerDatum</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> OracleAnswerDatum </span><span style="color:var(--shiki-token-keyword)">TeamGoals</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">deriving</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">newtype</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">Eq</span><span style="color:var(--shiki-color-text)">, </span><span style="color:var(--shiki-token-keyword)">Show</span><span style="color:var(--shiki-color-text)">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">PlutusTx.unstableMakeIsData &#x27;&#x27;OracleAnswerDatum</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-8"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Contract Datum<a href="#contract-datum" id="contract-datum" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">It consists of two fields:</p>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">List containing each person&#x27;s guess along with their payment public key hash. Key hash is used to tie guess with the guesser. Every time a new guess is made, we prepend it to this list.
This key hash is obtained from transaction signatories - we insist on key hash being present in signatories as otherwise anyone may override bet of someone else.</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Amount denoting the previously placed bet. Note that the total value in the UTxO belonging to contract is the culmination of <strong>all</strong> the previously placed bets and thus it isn&#x27;t in general equal to last placed bet. We use this to assert that the newly placed bet is more than the previous one by <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpBetStep</code> amount.</p>
</li>
</ol>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><div class="nx-absolute nx-top-0 nx-z-[1] nx-w-full nx-truncate nx-rounded-t-xl nx-bg-primary-700/5 nx-py-2 nx-px-4 nx-text-xs nx-text-gray-700 dark:nx-bg-primary-300/10 dark:nx-text-gray-200">BetRef.hs</div><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-pt-12 nx-pb-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">-- | List of guesses by users along with the maximum bet placed yet. A new guess gets /prepended/ to this list. Note that since we are always meant to increment previously placed bet with `brpBetStep`, the newly placed bet would necessarily be maximum (it would be foolish to initialize `brpBetStep` with some negative amounts).</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">data</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">BetRefDatum</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> BetRefDatum</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  { brdBets        </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> [(</span><span style="color:var(--shiki-token-keyword)">PubKeyHash</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">OracleAnswerDatum</span><span style="color:var(--shiki-color-text)">)]</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , brdPreviousBet </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Value</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  }</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">PlutusTx.unstableMakeIsData &#x27;&#x27;BetRefDatum</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-8"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Contract Redeemer<a href="#contract-redeemer" id="contract-redeemer" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">There are two actions available to user:</p>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">To place a bet - in which case they give their guess.</li>
<li class="nx-my-2">To take the bets in the pot after the result is out.</li>
</ol>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">This is therefore codified as:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><div class="nx-absolute nx-top-0 nx-z-[1] nx-w-full nx-truncate nx-rounded-t-xl nx-bg-primary-700/5 nx-py-2 nx-px-4 nx-text-xs nx-text-gray-700 dark:nx-bg-primary-300/10 dark:nx-text-gray-200">BetRef.hs</div><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-pt-12 nx-pb-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">-- | Redeemer representing choices available to the user.</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">data</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">BetRefAction</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> Bet </span><span style="color:var(--shiki-token-keyword)">!OracleAnswerDatum</span><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- ^ User makes a guess.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">                  </span><span style="color:var(--shiki-token-keyword)">|</span><span style="color:var(--shiki-color-text)"> Take                    </span><span style="color:var(--shiki-token-comment)">-- ^ User takes the pot.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">PlutusTx.unstableMakeIsData &#x27;&#x27;BetRefAction</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-8"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Contract Logic<a href="#contract-logic" id="contract-logic" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Placing a bet<a href="#placing-a-bet" id="placing-a-bet" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Initial bet gets placed as it is (in Cardano, spending validator script is executed only when spending an UTxO belonging to it but not for creating <em>at it</em>).</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">For subsequent bets, we require three conditions:</p>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">The bet must be before (inclusive) the <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpBetUntil</code> time.</li>
<li class="nx-my-2">There must be exactly one continuing output at the script address whose datum shall have the current guess prepended to it along with the current bet amount.</li>
<li class="nx-my-2">The current bet must be more than the previous bet by at least <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpBetStep</code> amount.</li>
</ol>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">This is coded as:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><div class="nx-absolute nx-top-0 nx-z-[1] nx-w-full nx-truncate nx-rounded-t-xl nx-bg-primary-700/5 nx-py-2 nx-px-4 nx-text-xs nx-text-gray-700 dark:nx-bg-primary-300/10 dark:nx-text-gray-200">BetRef.hs</div><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-pt-12 nx-pb-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">{-# </span><span style="color:var(--shiki-token-keyword)">INLINABLE</span><span style="color:var(--shiki-color-text)"> mkBetRefValidator&#x27; #-}</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">-- | Core smart contract logic. Read its description from Atlas guide.</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">mkBetRefValidator&#x27;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">BetRefParams</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">BetRefDatum</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">BetRefAction</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">ScriptContext</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Bool</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">mkBetRefValidator&#x27; (BetRefParams oraclePkh betUntil betReveal betStep) (BetRefDatum previousGuesses previousBet) brAction ctx </span><span style="color:var(--shiki-token-keyword)">=</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">case</span><span style="color:var(--shiki-color-text)"> brAction </span><span style="color:var(--shiki-token-keyword)">of</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    Bet guess  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">let</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        sOut </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">case</span><span style="color:var(--shiki-color-text)"> getContinuingOutputs ctx </span><span style="color:var(--shiki-token-keyword)">of</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          [sOut&#x27;]        </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> sOut&#x27;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          _anyOtherMatch </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> traceError </span><span style="color:var(--shiki-token-string-expression)">&quot;Expected only one continuing output.&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        outValue </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> txOutValue sOut</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        sIn </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> maybe (traceError </span><span style="color:var(--shiki-token-string-expression)">&quot;Could not find own input&quot;</span><span style="color:var(--shiki-color-text)">) txInInfoResolved (findOwnInput ctx)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        inValue </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> txOutValue sIn</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        (guessesOut</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> betOut) </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">case</span><span style="color:var(--shiki-color-text)"> outputToDatum sOut </span><span style="color:var(--shiki-token-keyword)">of</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          Nothing                                </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> traceError </span><span style="color:var(--shiki-token-string-expression)">&quot;Could not resolve for script output datum&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          Just (BetRefDatum guessesOut&#x27; betOut&#x27;) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> (guessesOut&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> betOut&#x27;)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">in</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        traceIfFalse</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-string-expression)">&quot;Must be before `BetUntil` time&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            (to betUntil </span><span style="color:var(--shiki-token-keyword)">`contains`</span><span style="color:var(--shiki-color-text)"> validRange) </span><span style="color:var(--shiki-token-keyword)">&amp;&amp;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        traceIfFalse</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-string-expression)">&quot;Guesses update is wrong&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            ((signerPkh</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> guess) </span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> previousGuesses </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> guessesOut) </span><span style="color:var(--shiki-token-keyword)">&amp;&amp;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        traceIfFalse</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-string-expression)">&quot;The current bet must be more than the previous bet by atleast `brpBetStep` amount&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            (outValue </span><span style="color:var(--shiki-token-keyword)">`geq`</span><span style="color:var(--shiki-color-text)"> (inValue </span><span style="color:var(--shiki-token-keyword)">&lt;&gt;</span><span style="color:var(--shiki-color-text)"> previousBet </span><span style="color:var(--shiki-token-keyword)">&lt;&gt;</span><span style="color:var(--shiki-color-text)"> betStep)) </span><span style="color:var(--shiki-token-keyword)">&amp;&amp;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        traceIfFalse</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-string-expression)">&quot;Out bet is wrong&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            (betOut </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> outValue </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-color-text)"> inValue)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-8"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Where we have the following common helpers for both the redemeer actions:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><div class="nx-absolute nx-top-0 nx-z-[1] nx-w-full nx-truncate nx-rounded-t-xl nx-bg-primary-700/5 nx-py-2 nx-px-4 nx-text-xs nx-text-gray-700 dark:nx-bg-primary-300/10 dark:nx-text-gray-200">BetRef.hs</div><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-pt-12 nx-pb-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">where</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">info</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">TxInfo</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    info </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> scriptContextTxInfo ctx</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">validRange</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">POSIXTimeRange</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    validRange </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> txInfoValidRange info</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">signerPkh</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">PubKeyHash</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    signerPkh </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">case</span><span style="color:var(--shiki-color-text)"> txInfoSignatories info </span><span style="color:var(--shiki-token-keyword)">of</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      [signerPkh&#x27;]   </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> signerPkh&#x27;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-constant)">[]</span><span style="color:var(--shiki-color-text)">             </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> traceError </span><span style="color:var(--shiki-token-string-expression)">&quot;No signatory&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      _anyOtherMatch </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> traceError </span><span style="color:var(--shiki-token-string-expression)">&quot;Expected only one signatory&quot;</span></span>
<span class="line"> </span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-function)">outputToDatum</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">FromData</span><span style="color:var(--shiki-color-text)"> b </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">TxOut</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Maybe</span><span style="color:var(--shiki-color-text)"> b</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    outputToDatum o </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">case</span><span style="color:var(--shiki-color-text)"> txOutDatum o </span><span style="color:var(--shiki-token-keyword)">of</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      NoOutputDatum      </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> Nothing</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      OutputDatum d      </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> processDatum d</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      OutputDatumHash dh </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> processDatum </span><span style="color:var(--shiki-token-keyword)">=&lt;&lt;</span><span style="color:var(--shiki-color-text)"> findDatum dh info</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">where</span><span style="color:var(--shiki-color-text)"> processDatum </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> fromBuiltinData </span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-color-text)"> getDatum</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-8"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Taking the bet pot<a href="#taking-the-bet-pot" id="taking-the-bet-pot" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">In this case we require the following four conditions:</p>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">This operation must occur after (inclusive) <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpBetReveal</code> time.</li>
<li class="nx-my-2">The script must get fully spend, i.e., there shouldn&#x27;t be any continuing outputs to this script address.</li>
<li class="nx-my-2">The reference input whose datum is used to see actual answer should belong to concerned Oracle.</li>
<li class="nx-my-2">Guess should be closest among all.</li>
</ol>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">This is therefore coded as:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><div class="nx-absolute nx-top-0 nx-z-[1] nx-w-full nx-truncate nx-rounded-t-xl nx-bg-primary-700/5 nx-py-2 nx-px-4 nx-text-xs nx-text-gray-700 dark:nx-bg-primary-300/10 dark:nx-text-gray-200">BetRef.hs</div><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-pt-12 nx-pb-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">    Take </span><span style="color:var(--shiki-token-keyword)">-&gt;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">let</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        Just guess </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> find ((</span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> signerPkh) </span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-color-text)"> fst) previousGuesses  </span><span style="color:var(--shiki-token-comment)">-- Note that `find` returns the first match. Since we were always prepending, this is valid.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        oracleIn </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">case</span><span style="color:var(--shiki-color-text)"> filter (isNothing </span><span style="color:var(--shiki-token-keyword)">.</span><span style="color:var(--shiki-color-text)"> txOutReferenceScript) (txInInfoResolved </span><span style="color:var(--shiki-token-keyword)">&lt;$&gt;</span><span style="color:var(--shiki-color-text)"> txInfoReferenceInputs info) </span><span style="color:var(--shiki-token-keyword)">of</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          [oracleIn&#x27;]    </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> oracleIn&#x27;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-constant)">[]</span><span style="color:var(--shiki-color-text)">             </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> traceError </span><span style="color:var(--shiki-token-string-expression)">&quot;No reference input provided&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          _anyOtherMatch </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> traceError </span><span style="color:var(--shiki-token-string-expression)">&quot;Expected only one reference input&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        oracleAnswer </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">case</span><span style="color:var(--shiki-color-text)"> outputToDatum oracleIn </span><span style="color:var(--shiki-token-keyword)">of</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          Nothing                                  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> traceError </span><span style="color:var(--shiki-token-string-expression)">&quot;Could not resolve for datum&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          (Just (OracleAnswerDatum oracleAnswer&#x27;)) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> oracleAnswer&#x27;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        guessDiff </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> getGuessDiff </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> snd guess</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        getGuessDiff (OracleAnswerDatum g) </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> abs (oracleAnswer </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-color-text)"> g)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        oracleInPkh </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">case</span><span style="color:var(--shiki-color-text)"> toPubKeyHash (txOutAddress oracleIn) </span><span style="color:var(--shiki-token-keyword)">of</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          Nothing  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> traceError </span><span style="color:var(--shiki-token-string-expression)">&quot;Not PKH for oracle address&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          Just pkh </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> pkh</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">in</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        traceIfFalse</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-string-expression)">&quot;Must be after `RevealTime`&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            (from betReveal </span><span style="color:var(--shiki-token-keyword)">`contains`</span><span style="color:var(--shiki-color-text)"> validRange) </span><span style="color:var(--shiki-token-keyword)">&amp;&amp;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        traceIfFalse</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-string-expression)">&quot;Must fully spend Script&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            (null (getContinuingOutputs ctx)) </span><span style="color:var(--shiki-token-keyword)">&amp;&amp;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        traceIfFalse</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-string-expression)">&quot;Reference input must be from Oracle address (wrt Payment part)&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            (oracleInPkh </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> oraclePkh) </span><span style="color:var(--shiki-token-keyword)">&amp;&amp;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        traceIfFalse</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-string-expression)">&quot;Guess is not closest&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            (all (</span><span style="color:var(--shiki-token-keyword)">\</span><span style="color:var(--shiki-color-text)">pg </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> getGuessDiff (snd pg) </span><span style="color:var(--shiki-token-keyword)">&gt;=</span><span style="color:var(--shiki-color-text)"> guessDiff) previousGuesses)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-8"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">And lo behold! This is our contract.</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="nx-sr-only">Footnotes<a href="#footnote-label" id="footnote-label" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2" id="user-content-fn-1">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">For instance, here we assert that UTxO being used as reference input must belong to Oracle&#x27;s address but do note that anyone can create an UTxO at Oracle&#x27;s address. <a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font] data-footnote-backref" data-footnote-backref="true" aria-label="Back to content" href="/getting-started/smart-contract-intro#user-content-fnref-1">↩</a></p>
</li>
</ol>
</section><div class="nx-mt-16"></div><div class="nx-mb-8 nx-flex nx-items-center nx-border-t nx-pt-8 dark:nx-border-neutral-800 contrast-more:nx-border-neutral-400 dark:contrast-more:nx-border-neutral-400 print:nx-hidden"><a title="How to build?" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-pr-4 rtl:nx-pl-4" href="/getting-started/how-to-build"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 ltr:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>How to build?</a><a title="Operations over Contract" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-ml-auto ltr:nx-pl-4 ltr:nx-text-right rtl:nx-mr-auto rtl:nx-pr-4 rtl:nx-text-left" href="/getting-started/operations">Operations over Contract<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 rtl:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></a></div></main></article></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/getting-started/smart-contract-intro","query":{},"buildId":"ujomVUVsBD45hndN6r9Ly","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>