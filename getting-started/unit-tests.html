<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Atlas | Unit Tests</title><meta name="robots" content="index,follow"/><meta name="description" content="All-in-one solution for writing off-chain code for Plutus contracts"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="https://www.geniusyield.co"/><meta name="twitter:creator" content="@GeniusyieldO"/><meta property="og:title" content="Atlas | Unit Tests"/><meta property="og:description" content="All-in-one solution for writing off-chain code for Plutus contracts"/><meta property="og:url" content="https://atlas-app.io"/><meta property="og:image" content="/open-graph.png"/><meta property="og:image:alt" content="Atlas - Application backend for Plutus smart contracts on Cardano"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><link rel="canonical" href="https://atlas-app.io"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/><style>
        :root {
          --nextra-primary-hue: 212deg;
          --nextra-primary-saturation: 100%;
          --nextra-navbar-height: 4rem;
          --nextra-menu-height: 3.75rem;
          --nextra-banner-height: 2.5rem;
        }
        
        .dark {
          --nextra-primary-hue: 204deg;
          --nextra-primary-saturation: 100%;
        }
      </style><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#ffffff"/><meta name="next-head-count" content="27"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/2e27e0463af74fb7.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/2e27e0463af74fb7.css" crossorigin="" data-n-g=""/><link rel="preload" href="/_next/static/css/445c4173ffc2bf04.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/445c4173ffc2bf04.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-6ef43a8d4a395f49.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-9ea5e8969a75bc93.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-3b098c3f5edaee6d.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/484-ecb78068700f2b30.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/getting-started/unit-tests-52d0ddc283db42c6.js" defer="" crossorigin=""></script><script src="/_next/static/1Xa-Stng7ls29pFVyzeKI/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/1Xa-Stng7ls29pFVyzeKI/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&false)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}else{c.add('dark')}if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'dark'}catch(e){}}()</script><div dir="ltr"><script>document.documentElement.setAttribute('dir','ltr')</script><div class="nextra-nav-container nx-sticky nx-top-0 nx-z-20 nx-w-full nx-bg-transparent print:nx-hidden"><div class="nextra-nav-container-blur nx-pointer-events-none nx-absolute nx-z-[-1] nx-h-full nx-w-full nx-bg-white dark:nx-bg-dark nx-shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] dark:nx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:nx-shadow-[0_0_0_1px_#000] contrast-more:dark:nx-shadow-[0_0_0_1px_#fff]"></div><nav class="nx-mx-auto nx-flex nx-h-[var(--nextra-navbar-height)] nx-max-w-[90rem] nx-items-center nx-justify-end nx-gap-2 nx-pl-[max(env(safe-area-inset-left),1.5rem)] nx-pr-[max(env(safe-area-inset-right),1.5rem)]"><a class="nx-flex nx-items-center hover:nx-opacity-75 ltr:nx-mr-auto rtl:nx-ml-auto" href="/"><img alt="Atlas Logo" loading="lazy" width="124" height="42" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/atlas-logo-dark-mode.62b4f6dd.svg"/></a><a class="nx-text-sm contrast-more:nx-text-gray-700 contrast-more:dark:nx-text-gray-100 nx-relative -nx-ml-2 nx-hidden nx-whitespace-nowrap nx-p-2 md:nx-inline-block nx-font-medium nx-subpixel-antialiased" aria-current="true" href="/introduction"><span class="nx-absolute nx-inset-x-0 nx-text-center">Documentation</span><span class="nx-invisible nx-font-medium">Documentation</span></a><div class="nextra-search nx-relative md:nx-w-64 nx-hidden md:nx-inline-block mx-min-w-[200px]"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div><a href="https://github.com/geniusyield/atlas" target="_blank" rel="noreferrer" class="nx-p-2 nx-text-current"><svg width="24" height="24" fill="currentColor" viewBox="3 3 18 18"><title>GitHub</title><path d="M12 3C7.0275 3 3 7.12937 3 12.2276C3 16.3109 5.57625 19.7597 9.15374 20.9824C9.60374 21.0631 9.77249 20.7863 9.77249 20.5441C9.77249 20.3249 9.76125 19.5982 9.76125 18.8254C7.5 19.2522 6.915 18.2602 6.735 17.7412C6.63375 17.4759 6.19499 16.6569 5.8125 16.4378C5.4975 16.2647 5.0475 15.838 5.80124 15.8264C6.51 15.8149 7.01625 16.4954 7.18499 16.7723C7.99499 18.1679 9.28875 17.7758 9.80625 17.5335C9.885 16.9337 10.1212 16.53 10.38 16.2993C8.3775 16.0687 6.285 15.2728 6.285 11.7432C6.285 10.7397 6.63375 9.9092 7.20749 9.26326C7.1175 9.03257 6.8025 8.08674 7.2975 6.81794C7.2975 6.81794 8.05125 6.57571 9.77249 7.76377C10.4925 7.55615 11.2575 7.45234 12.0225 7.45234C12.7875 7.45234 13.5525 7.55615 14.2725 7.76377C15.9937 6.56418 16.7475 6.81794 16.7475 6.81794C17.2424 8.08674 16.9275 9.03257 16.8375 9.26326C17.4113 9.9092 17.76 10.7281 17.76 11.7432C17.76 15.2843 15.6563 16.0687 13.6537 16.2993C13.98 16.5877 14.2613 17.1414 14.2613 18.0065C14.2613 19.2407 14.25 20.2326 14.25 20.5441C14.25 20.7863 14.4188 21.0746 14.8688 20.9824C16.6554 20.364 18.2079 19.1866 19.3078 17.6162C20.4077 16.0457 20.9995 14.1611 21 12.2276C21 7.12937 16.9725 3 12 3Z"></path></svg><span class="nx-sr-only">GitHub</span><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a><button type="button" aria-label="Menu" class="nextra-hamburger -nx-mr-2 nx-rounded nx-p-2 active:nx-bg-gray-400/20 md:nx-hidden"><svg fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" class=""><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16"></path></g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16"></path><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 18h16"></path></g></svg></button></nav></div><div class="nx-mx-auto nx-flex nx-max-w-[90rem]"><div class="motion-reduce:nx-transition-none [transition:background-color_1.5s_ease] nx-bg-transparent"></div><aside class="nextra-sidebar-container nx-flex nx-flex-col md:nx-top-16 md:nx-shrink-0 motion-reduce:nx-transform-none nx-transform-gpu nx-transition-all nx-ease-in-out print:nx-hidden md:nx-w-64 md:nx-sticky md:nx-self-start max-md:[transform:translate3d(0,-100%,0)]"><div class="nx-px-4 nx-pt-4 md:nx-hidden"><div class="nextra-search nx-relative md:nx-w-64"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div></div><div class="nx-overflow-y-auto nx-overflow-x-hidden nx-p-4 nx-grow md:nx-h-[calc(100vh-var(--nextra-navbar-height)-var(--nextra-menu-height))] nextra-scrollbar"><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100"><ul class="nx-flex nx-flex-col nx-gap-1 nextra-menu-desktop max-md:nx-hidden"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/introduction">Introduction</a></li><li class="open"><a class="nx-items-center nx-justify-between nx-gap-2 nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started">Getting Started<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-h-[18px] nx-min-w-[18px] nx-rounded-sm nx-p-0.5 hover:nx-bg-gray-800/5 dark:hover:nx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="nx-origin-center nx-transition-transform rtl:-nx-rotate-180 ltr:nx-rotate-90 rtl:nx-rotate-[-270deg]"></path></svg></a><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100 ltr:nx-pr-0 rtl:nx-pl-0 nx-pt-1"><ul class="nx-flex nx-flex-col nx-gap-1 nx-relative before:nx-absolute before:nx-inset-y-1 before:nx-w-px before:nx-bg-gray-200 before:nx-content-[&quot;&quot;] dark:before:nx-bg-neutral-800 ltr:nx-pl-3 ltr:before:nx-left-0 rtl:nx-pr-3 rtl:before:nx-right-0 ltr:nx-ml-3 rtl:nx-mr-3"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started/how-to-build">How to build?</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started/smart-contract-intro">Smart Contract</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started/operations">Operations over Contract</a></li><li class="nx-flex nx-flex-col nx-gap-1 active"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-bg-primary-100 nx-font-semibold nx-text-primary-800 dark:nx-bg-primary-400/10 dark:nx-text-primary-600 contrast-more:nx-border-primary-500 contrast-more:dark:nx-border-primary-500" href="/getting-started/unit-tests">Unit Tests</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started/integration-tests">Integration Tests</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started/endpoints">Creating Endpoints</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/getting-started/browser-integration">Browser Integration</a></li></ul></div></div></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/more-tutorials">More Tutorials</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a href="https://haddock.atlas-app.io/" target="_blank" rel="noreferrer" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">API Reference (Haddock) ⬈<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a></li></ul></div></div></div><div class="nx-sticky nx-bottom-0 nx-bg-white dark:nx-bg-dark nx-mx-4 nx-py-4 nx-shadow-[0_-12px_16px_#fff] nx-flex nx-items-center nx-gap-2 dark:nx-border-neutral-800 dark:nx-shadow-[0_-12px_16px_#111] contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-shadow-none nx-border-t" data-toggle-animation="off"><button title="Hide sidebar" class="max-md:nx-hidden nx-h-7 nx-rounded-md nx-transition-colors nx-text-gray-600 dark:nx-text-gray-400 nx-px-2 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50"><svg height="12" width="12" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M4.177 7.823l2.396-2.396A.25.25 0 017 5.604v4.792a.25.25 0 01-.427.177L4.177 8.177a.25.25 0 010-.354z" class=""></path><path fill-rule="evenodd" d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0114.25 16H1.75A1.75 1.75 0 010 14.25V1.75zm1.75-.25a.25.25 0 00-.25.25v12.5c0 .138.112.25.25.25H9.5v-13H1.75zm12.5 13H11v-13h3.25a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25z"></path></svg></button></div></aside><nav class="nextra-toc nx-order-last nx-hidden nx-w-64 nx-shrink-0 xl:nx-block print:nx-hidden nx-px-4" aria-label="table of contents"><div class="nextra-scrollbar nx-sticky nx-top-16 nx-overflow-y-auto nx-pr-4 nx-pt-6 nx-text-sm [hyphens:auto] nx-max-h-[calc(100vh-var(--nextra-navbar-height)-env(safe-area-inset-bottom))] ltr:-nx-mr-4 rtl:-nx-ml-4"><p class="nx-mb-4 nx-font-semibold nx-tracking-tight">On This Page</p><ul><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#why-not-just-use-plutus-simple-model-instead-of-the-wrapper" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Why not just use &quot;Plutus simple model&quot; instead of the wrapper?</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#unit-tests-for-placing-a-bet-operation" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Unit tests for placing a bet operation</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#defining-run-for-placing-a-bet-operation" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Defining Run for placing a bet operation</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#understanding-testrun" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Understanding testRun</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#defining-a-trace-to-call-placebetrun" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Defining a trace to call placeBetRun</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#multiple-bets-trace" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Multiple bets trace</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#but-sometimes-we-want-a-test-to-fail" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">But sometimes we want a test to fail!</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#unit-tests-for-taking-the-bet-pot" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Unit tests for taking the bet pot</a></li></ul><div class="nx-mt-8 nx-border-t nx-bg-white nx-pt-8 nx-shadow-[0_-12px_16px_white] dark:nx-bg-dark dark:nx-shadow-[0_-12px_16px_#111] nx-sticky nx-bottom-0 nx-flex nx-flex-col nx-items-start nx-gap-2 nx-pb-8 dark:nx-border-neutral-800 contrast-more:nx-border-t contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-border-neutral-400"><a href="https://github.com/geniusyield/atlas-docs/issues/new?title=Feedback%20for%20%E2%80%9CUnit%20Tests%E2%80%9D&amp;labels=feedback" target="_blank" rel="noreferrer" class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50">Question? Give us feedback →<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a><a class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50" href="https://github.com/geniusyield/atlas-docs/tree/main/src/pages/getting-started/unit-tests.mdx">Edit this page</a></div></div></nav><div id="reach-skip-nav"></div><article class="nx-w-full nx-break-words nextra-content nx-flex nx-min-h-[calc(100vh-var(--nextra-navbar-height))] nx-min-w-0 nx-justify-center nx-pb-8 nx-pr-[calc(env(safe-area-inset-right)-1.5rem)]"><main class="nx-w-full nx-min-w-0 nx-max-w-6xl nx-px-6 nx-pt-4 md:nx-px-12"><div class="nextra-breadcrumb nx-mt-1.5 nx-flex nx-items-center nx-gap-1 nx-overflow-hidden nx-text-sm nx-text-gray-500 dark:nx-text-gray-400 contrast-more:nx-text-current"><div class="nx-whitespace-nowrap nx-transition-colors nx-min-w-[24px] nx-overflow-hidden nx-text-ellipsis hover:nx-text-gray-900 dark:hover:nx-text-gray-100" title="Getting Started"><a href="/getting-started">Getting Started</a></div><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-w-3.5 nx-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg><div class="nx-whitespace-nowrap nx-transition-colors nx-font-medium nx-text-gray-700 contrast-more:nx-font-bold contrast-more:nx-text-current dark:nx-text-gray-100 contrast-more:dark:nx-text-current" title="Unit Tests">Unit Tests</div></div><h1 class="nx-mt-2 nx-text-4xl nx-font-bold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100">Unit Tests</h1>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Writing smart contracts &amp; writing tests go hand in hand. Tests are also an excellent way to conveniently check working of our smart contract instead of building transactions using <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">cardano-cli</code> and submitting them to local node.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Now that we have written our smart contract and defined the required operations over it, let&#x27;s see whether its working as expected.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Our test suite is a wrapper around <a href="https://github.com/mlabs-haskell/plutus-simple-model" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">Plutus simple model<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a><sup><a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]" id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label" href="/getting-started/unit-tests#user-content-fn-1">1</a></sup> which is created by MLabs.</p>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-yellow-100 nx-bg-yellow-50 nx-text-yellow-900 dark:nx-border-yellow-200/30 dark:nx-bg-yellow-700/30 dark:nx-text-yellow-200"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;">⚠️</div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">MLabs is working on an evolution of PSM, namely <a href="https://github.com/mlabs-haskell/clb" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">CLB<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> which is intended to work exclusively with Atlas. Thus, we have deprecated support of PSM and would soon document overhaul of this test suite. If you would like to avoid using PSM and wait till CLB is ready, you can skip to next section, namely, <a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]" href="/getting-started/integration-tests">Integration Tests</a>.</p><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Currently our PSM wrapper does not support operations related to staking, namely, stake key registration, delegation, de-registration and rewards withdrawal.</p></div></div>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Why not just use &quot;Plutus simple model&quot; instead of the wrapper?<a href="#why-not-just-use-plutus-simple-model-instead-of-the-wrapper" id="why-not-just-use-plutus-simple-model-instead-of-the-wrapper" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>Reusability</strong>: Well firstly to maintain compatibility with our toolchain. For instance, our operations were making use of <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GYTxQueryMonad</code> monad and thus to be able to reuse those same operations we would need to define an instance for it.</p>
</li>
<li class="nx-my-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>Additional checks</strong>: But secondly and more importantly, plutus simple model lacks some basic checks, for instance:</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Whether a UTxO satisfies minimum ada requirement.</li>
<li class="nx-my-2">Transaction fees requirement.</li>
<li class="nx-my-2">Transaction signatures requirement, etc.</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">We already handle these cases using our transaction building machinery and thus tests written here reflect the actual environment more.</p>
</li>
</ol>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-orange-100 nx-bg-orange-50 nx-text-orange-800 dark:nx-border-orange-400/30 dark:nx-bg-orange-400/20 dark:nx-text-orange-300"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;">💡</div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">For this guide there should be no need to go over the plutus simple model documentation but this doesn&#x27;t mean that one shouldn&#x27;t. It&#x27;s very lucid and takes few minutes to cover and can be accessed by cloning <a href="https://github.com/mlabs-haskell/plutus-simple-model" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">their<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> repository, entering the <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">docs</code> folder and running <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">mdbook serve --open</code>.</p></div></div>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Unit tests for placing a bet operation<a href="#unit-tests-for-placing-a-bet-operation" id="unit-tests-for-placing-a-bet-operation" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-yellow-100 nx-bg-yellow-50 nx-text-yellow-900 dark:nx-border-yellow-200/30 dark:nx-bg-yellow-700/30 dark:nx-text-yellow-200"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;">📃</div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Entire code file for tests pertaining to this operation is available <a href="https://github.com/geniusyield/atlas-examples/tree/main/bet-ref/tests/BetRef/Tests/PlaceBet.hs" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">here<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>. Note that we are using <a href="https://hackage.haskell.org/package/tasty" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">tasty</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> to write our tests and a file calling these individual unit tests is <a href="https://github.com/geniusyield/atlas-examples/tree/main/bet-ref/tests/betref-tests.hs" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">here<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>.</p></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Our objective here would be to write tests for each of our operation, hence the name &quot;unit tests&quot;. Though one may write other sort of tests as well, including property based ones.</p>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defining <em>Run</em> for placing a bet operation<a href="#defining-run-for-placing-a-bet-operation" id="defining-run-for-placing-a-bet-operation" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Before any jibber-jabber, let&#x27;s see the code so that we know it isn&#x27;t as complex as it might seem:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-function)">placeBetRun</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxOutRef</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">BetRefParams</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">OracleAnswerDatum</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYValue</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Maybe</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxOutRef</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxMonadRun</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxId</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">placeBetRun refScript brp guess bet mPreviousBetsUtxoRef </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  addr </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> ownAddress</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  skeleton </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> placeBet refScript brp guess bet addr mPreviousBetsUtxoRef</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  sendSkeleton skeleton</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-blue-200 nx-bg-blue-100 nx-text-blue-900 dark:nx-border-blue-200/30 dark:nx-bg-blue-900/30 dark:nx-text-blue-200"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20" class="nx-mt-1"><path fill-rule="evenodd" clip-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg></div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>Why do we call it &quot;<em>run</em>&quot;?</strong> Well if you have gone over the documentation of <a href="https://github.com/mlabs-haskell/plutus-simple-model" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">plutus simple model<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>, you&#x27;ll know that they have this &quot;<em>Run</em>&quot; monad where actually most of the test code gets executed and we have wrapper around this type, which we call <a href="https://haddock.atlas-app.io/GeniusYield-TxBuilder-Class.html#v:utxoAtTxOutRef" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GYTxMonadRun</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>. But as an end developer, there is no need to understand about it.</p><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Also our <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GYTxMonadRun</code> has an instance of <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GYTxQueryMonad</code>.</p></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">The idea here is that any tests we do related to performing the bet operation would need to call the <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">placeBet</code> function which we have defined before. Therefore we have defined a <em>run</em> to call this function. Our <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">placeBetRun</code> function takes all those parameters which are required by <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">placeBet</code> function, except the address as that we are able to get using <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">ownAddress</code> function<sup><a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]" id="user-content-fnref-2" data-footnote-ref="true" aria-describedby="footnote-label" href="/getting-started/unit-tests#user-content-fn-2">2</a></sup>. <a href="https://haddock.atlas-app.io/GeniusYield-TxBuilder-Run.html#v:ownAddress" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">ownAddress</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> function is defined in <a href="https://haddock.atlas-app.io/GeniusYield-TxBuilder-Run.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GeniusYield.TxBuilder.Run</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> module where actually most of the code related to our wrapper lives and it gives the address of the wallet running this <em>run</em> as we&#x27;ll shortly see.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Lastly <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">sendSkeleton</code> can be understood as submitting the transaction. It will update the mock ledger state and return the transaction id for the submitted transaction. Note that it does raise an exception in case it fails to submit the transaction.</p>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Understanding <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">testRun</code><a href="#understanding-testrun" id="understanding-testrun" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Before we see a trace calling the run we just defined, notice that in our <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">testGroup</code>, we have the first test written as:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">testRun </span><span style="color:var(--shiki-token-string-expression)">&quot;Balance checks after placing first bet&quot;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> firstBetTrace (OracleAnswerDatum </span><span style="color:var(--shiki-token-constant)">3</span><span style="color:var(--shiki-color-text)">) (valueFromLovelace </span><span style="color:var(--shiki-token-constant)">20_000_000</span><span style="color:var(--shiki-color-text)">) </span><span style="color:var(--shiki-token-constant)">0_182_793</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Now what is this <a href="https://haddock.atlas-app.io/GeniusYield-Test-Utils.html#v:testRun" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">testRun</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>?</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">This function takes a string to represent the name of the test and a continuation function (of type <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Wallets -&gt; Run a</code>) and then internally generates wallets to give to our continuation function.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">The type <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Wallets</code> is defined as:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">data</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Wallets</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> Wallets</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    { w1 </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!Wallet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    , w2 </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!Wallet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    , w3 </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!Wallet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    , w4 </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!Wallet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    , w5 </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!Wallet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    , w6 </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!Wallet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    , w7 </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!Wallet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    , w8 </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!Wallet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    , w9 </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!Wallet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    } </span><span style="color:var(--shiki-token-keyword)">deriving</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">Show</span><span style="color:var(--shiki-color-text)">, </span><span style="color:var(--shiki-token-keyword)">Eq</span><span style="color:var(--shiki-color-text)">, </span><span style="color:var(--shiki-token-keyword)">Ord</span><span style="color:var(--shiki-color-text)">)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">where <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Wallet</code> is:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">data</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Wallet</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> Wallet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    { walletPaymentSigningKey </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!GYPaymentSigningKey</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    , walletNetworkId         </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!GYNetworkId</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    , walletName              </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">!String</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    }</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">deriving</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">Show</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Eq</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Ord</span><span style="color:var(--shiki-color-text)">)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Thus our <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">testRun</code> function, generates these 9 wallets where each wallet is having the following three assets:</p>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Million ada.</li>
<li class="nx-my-2">Million <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">fakeGold</code>.</li>
<li class="nx-my-2">Million <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">fakeIron</code>.</li>
</ul>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">where <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">fakeGold</code> and <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">fakeIron</code> are our two non-native assets.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Each call to <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">testRun</code> (as you can see - we have multiple tests, all beginning with <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">testRun</code>) runs the given test with a fresh (new) blockchain ledger state having given the above balances to those 9 wallets.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">In our case, <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">&quot;Balance checks after placing first bet&quot;</code> is the name of the test and <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">firstBetTrace (OracleAnswerDatum 3) (valueFromLovelace 20_000_000) 0_182_793</code> is our continuation function.</p>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Defining a trace to call <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">placeBetRun</code><a href="#defining-a-trace-to-call-placebetrun" id="defining-a-trace-to-call-placebetrun" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Now let&#x27;s see the definition <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">firstBetTrace</code> we briefly encountered above:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">-- | Trace for placing the first bet.</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">firstBetTrace</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">OracleAnswerDatum</span><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- ^ Guess</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">              </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYValue</span><span style="color:var(--shiki-color-text)">            </span><span style="color:var(--shiki-token-comment)">-- ^ Bet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">              </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Wallets</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Run</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">()</span><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- Our continuation function</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">firstBetTrace dat bet ws</span><span style="color:var(--shiki-token-keyword)">@</span><span style="color:var(--shiki-color-text)">Wallets{..} </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- First step: Get the required parameters for initializing our parameterized script and add the corresponding reference script</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  (brp</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> refScript) </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> computeParamsAndAddRefScript </span><span style="color:var(--shiki-token-constant)">40</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">100</span><span style="color:var(--shiki-color-text)"> (valueFromLovelace </span><span style="color:var(--shiki-token-constant)">200_000_000</span><span style="color:var(--shiki-color-text)">) ws</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  void </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> runWallet w1 </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- following operations are ran by first wallet, `w1`</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- Second step: Perform the actual run.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    withWalletBalancesCheckSimple [w1 </span><span style="color:var(--shiki-token-keyword)">:=</span><span style="color:var(--shiki-color-text)"> valueNegate bet] </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      placeBetRun refScript brp dat bet Nothing</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Here the last argument is of type <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Wallets</code> as we noted.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Note that this function starts by calling <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">computeParamsAndAddRefScript</code>, therefore let&#x27;s see about it:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">-- | Function to compute the parameters for the contract and add the corresponding refernce script.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">computeParamsAndAddRefScript</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Integer</span><span style="color:var(--shiki-color-text)">                                    </span><span style="color:var(--shiki-token-comment)">-- ^ Bet Until slot</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Integer</span><span style="color:var(--shiki-color-text)">                                    </span><span style="color:var(--shiki-token-comment)">-- ^ Bet Reveal slot</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYValue</span><span style="color:var(--shiki-color-text)">                                    </span><span style="color:var(--shiki-token-comment)">-- ^ Bet step value</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Wallets</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Run</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">BetRefParams</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxOutRef</span><span style="color:var(--shiki-color-text)">)  </span><span style="color:var(--shiki-token-comment)">-- Our continuation</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">computeParamsAndAddRefScript betUntil&#x27; betReveal&#x27; betStep Wallets{..} </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">let</span><span style="color:var(--shiki-color-text)"> betUntil </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> slotFromApi (fromInteger betUntil&#x27;)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      betReveal </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> slotFromApi (fromInteger betReveal&#x27;)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  fmap fromJust </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> runWallet w1 </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    betUntilTime </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> slotToBeginTime betUntil</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    betRevealTime </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> slotToBeginTime betReveal</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">let</span><span style="color:var(--shiki-color-text)"> brp </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> BetRefParams (pubKeyHashToPlutus </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> walletPubKeyHash w8) (timeToPlutus betUntilTime) (timeToPlutus betRevealTime) (valueToPlutus betStep)  </span><span style="color:var(--shiki-token-comment)">-- let oracle be wallet `w8`.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    mORef </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> addRefScript (walletAddress w9) (betRefValidator&#x27; brp)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">case</span><span style="color:var(--shiki-color-text)"> mORef </span><span style="color:var(--shiki-token-keyword)">of</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      Nothing        </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> fail </span><span style="color:var(--shiki-token-string-expression)">&quot;Couldn&#x27;t find index of the Reference Script in outputs&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      Just refScript </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> return (brp</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> refScript)</span></span>
<span class="line"> </span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Our first step is to construct the parameter (<code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">BetRefParams</code>) for our parameterized contract. Recall its type is:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">data</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">BetRefParams</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> BetRefParams</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  {</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    brpOraclePkh </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">PubKeyHash</span><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- ^ Oracle&#x27;s payment public key hash. This is needed to assert that UTxO being looked at indeed belongs to the Oracle.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , brpBetUntil  </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">POSIXTime</span><span style="color:var(--shiki-color-text)">   </span><span style="color:var(--shiki-token-comment)">-- ^ Time until which bets can be placed.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , brpBetReveal </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">POSIXTime</span><span style="color:var(--shiki-color-text)">   </span><span style="color:var(--shiki-token-comment)">-- ^ Time at which Oracle will reveal the correct match result.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , brpBetStep   </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Value</span><span style="color:var(--shiki-color-text)">       </span><span style="color:var(--shiki-token-comment)">-- ^ Each newly placed bet must be more than previous bet by `brpBetStep` amount.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  }</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">For <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpBetUntil</code>, we choose slot 40 but since plutus works in posix time, we need to enter a monad having an instance of <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GYTxQueryMonad</code> to get posix time from slot and therefore that calculation happens inside <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">runWallet w1</code>. Similarly for <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpBetReveal</code> we chose slot 100.</p>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-blue-200 nx-bg-blue-100 nx-text-blue-900 dark:nx-border-blue-200/30 dark:nx-bg-blue-900/30 dark:nx-text-blue-200"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20" class="nx-mt-1"><path fill-rule="evenodd" clip-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path></svg></div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><a href="https://haddock.atlas-app.io/GeniusYield-Test-Utils.html#v:runWallet" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">runWallet</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> is a utility function which enables us to give the environment. Hm.. what environment you ask? Well in general when constructing the transaction from skeleton we need some context, like who is actually submitting this transaction? As we&#x27;ll need their address to give them the change output. <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">runWallet</code> takes as first argument, the wallet to generate context from and then the actual <em>run</em> to run against this context.</p></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Now coming back to our parameters, for <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpOraclePkh</code> parameter, we chose that for wallet 8. And we take our step amount to be 200 ada.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Though it is not required for this operation (where we place the first bet) but since our <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">placeBet</code> function is overloaded to accept the subsequent bet case too - we need to give reference to the UTxO containing reference script. For that we have a helper function called <a href="https://haddock.atlas-app.io/GeniusYield-Test-Utils.html#v:addRefScript" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">addRefScript</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> which adds the given script at a given address (we chose that for wallet 9) and returns the reference to it (in <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Maybe</code>).</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Now we are almost done to call our <em>run</em> with just one more line to understand.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">withWalletBalancesCheckSimple</code> takes a list of tuple<sup><a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]" id="user-content-fnref-3" data-footnote-ref="true" aria-describedby="footnote-label" href="/getting-started/unit-tests#user-content-fn-3">3</a></sup> where the first element of the tuple is the wallet and second element denotes the difference in the wallet&#x27;s value which we expect after the execution of the operation defined inside its <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">do</code> block excluding ada required for transaction fees and to satisfy minimum ada requirements of the generated output<sup><a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]" id="user-content-fnref-4" data-footnote-ref="true" aria-describedby="footnote-label" href="/getting-started/unit-tests#user-content-fn-4">4</a></sup>. Here we want the balance of wallet 1 (which is the one actually calling this operation) to decrease by the bet amount and also the fees.</p>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-orange-100 nx-bg-orange-50 nx-text-orange-800 dark:nx-border-orange-400/30 dark:nx-bg-orange-400/20 dark:nx-text-orange-300"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;">💡</div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0"><strong>How do we know the fees?</strong>
Well by running the test without it and then noting the transaction fees from the log messages.</p></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">And this covers our first test 🥳.</p>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Multiple bets trace<a href="#multiple-bets-trace" id="multiple-bets-trace" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Now let&#x27;s write a slightly more involved trace. This time we&#x27;ll make our trace parameteric over the required contract parameters.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Here is the signature of our trace:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">-- | Trace which allows for multiple bets.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">multipleBetsTraceWrapper</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Integer</span><span style="color:var(--shiki-color-text)">                                            </span><span style="color:var(--shiki-token-comment)">-- ^ slot for betUntil</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Integer</span><span style="color:var(--shiki-color-text)">                                            </span><span style="color:var(--shiki-token-comment)">-- ^ slot for betReveal</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYValue</span><span style="color:var(--shiki-color-text)">                                            </span><span style="color:var(--shiki-token-comment)">-- ^ bet step</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> [(</span><span style="color:var(--shiki-token-keyword)">Wallets</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Wallet</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">OracleAnswerDatum</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYValue</span><span style="color:var(--shiki-color-text)">)]  </span><span style="color:var(--shiki-token-comment)">-- ^ List denoting the bets</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Wallets</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Run</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">()</span><span style="color:var(--shiki-color-text)">                                  </span><span style="color:var(--shiki-token-comment)">-- Our continuation function</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">multipleBetsTraceWrapper betUntil&#x27; betReveal&#x27; betStep walletBets ws </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- First step: Get the required parameters for initializing our parameterized script and add the corresponding reference script</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  (brp</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> refScript) </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> computeParamsAndAddRefScript betUntil&#x27; betReveal&#x27; betStep ws</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- Second step: Perform the actual bet operations</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  multipleBetsTraceCore brp refScript walletBets ws</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">The first three parameters correspond to the parameters of contract.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">The fourth parameter denotes the different bets.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">We may for instance call this function like so:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="text" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="text" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">testRun &quot;Balance checks with multiple bets&quot; $ multipleBetsTraceWrapper 400 1000 (valueFromLovelace 10_000_000) </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  [ (w1, OracleAnswerDatum 1, valueFromLovelace 10_000_000)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , (w2, OracleAnswerDatum 2, valueFromLovelace 20_000_000)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , (w3, OracleAnswerDatum 3, valueFromLovelace 30_000_000)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , (w2, OracleAnswerDatum 4, valueFromLovelace 50_000_000)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , (w4, OracleAnswerDatum 5, valueFromLovelace 65_000_000 &lt;&gt; fakeGold 1000)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  ]</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Next we want to add our reference script and compute the actual contract parameters (converting slot to posix) - which is again handled like before.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">We would then like to perform the actual bet operations. But this time we won&#x27;t concern ourselves much with actual fees but rather take a threshold of 1 ada. Our approach here is to compare the balances before performaing any operation and after performing all the operations and then see that each wallet has lost the bet amount they placed considering threshold fees.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Note: We use <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">balance</code> function to get the balance for the given wallet.</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">-- | Trace which allows for multiple bets.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">multipleBetsTraceCore</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">BetRefParams</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxOutRef</span><span style="color:var(--shiki-color-text)">                                         </span><span style="color:var(--shiki-token-comment)">-- ^ Reference script</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> [(</span><span style="color:var(--shiki-token-keyword)">Wallets</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Wallet</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">OracleAnswerDatum</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYValue</span><span style="color:var(--shiki-color-text)">)]  </span><span style="color:var(--shiki-token-comment)">-- ^ List denoting the bets</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Wallets</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Run</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">()</span><span style="color:var(--shiki-color-text)">                                  </span><span style="color:var(--shiki-token-comment)">-- Our continuation function</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">multipleBetsTraceCore brp refScript walletBets ws</span><span style="color:var(--shiki-token-keyword)">@</span><span style="color:var(--shiki-color-text)">Wallets{..} </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">let</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">      -- | Perform the actual bet operation by the corresponding wallet.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      performBetOperations </span><span style="color:var(--shiki-token-constant)">[]</span><span style="color:var(--shiki-color-text)"> _ </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> return </span><span style="color:var(--shiki-token-constant)">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      performBetOperations ((getWallet</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> dat</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> bet) </span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> remWalletBets) isFirst </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> isFirst </span><span style="color:var(--shiki-token-keyword)">then</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          void </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> runWallet (getWallet ws) </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            void </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> placeBetRun refScript brp dat bet Nothing</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          performBetOperations remWalletBets False</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">else</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-comment)">-- need to get previous bet utxo</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          void </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> runWallet (getWallet ws) </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            betRefAddr </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> betRefAddress brp</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            [_scriptUtxo</span><span style="color:var(--shiki-token-keyword)">@</span><span style="color:var(--shiki-color-text)">GYUTxO {utxoRef}] </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> utxosToList </span><span style="color:var(--shiki-token-keyword)">&lt;$&gt;</span><span style="color:var(--shiki-color-text)"> utxosAtAddress betRefAddr</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            void </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> placeBetRun refScript brp dat bet (Just utxoRef)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          performBetOperations remWalletBets False</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">      -- | To sum the bet amount for the corresponding wallet.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      sumWalletBets _wallet </span><span style="color:var(--shiki-token-constant)">[]</span><span style="color:var(--shiki-color-text)"> acc </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> acc</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      sumWalletBets wallet ((getWallet</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> _dat</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> bet) </span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> remWalletBets) acc </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> sumWalletBets wallet remWalletBets (</span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> getWallet ws </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> wallet </span><span style="color:var(--shiki-token-keyword)">then</span><span style="color:var(--shiki-color-text)"> acc </span><span style="color:var(--shiki-token-keyword)">&lt;&gt;</span><span style="color:var(--shiki-color-text)"> valueNegate bet </span><span style="color:var(--shiki-token-keyword)">else</span><span style="color:var(--shiki-color-text)"> acc)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">      -- | Idea here is that for each wallet, we want to know how much has been bet. If we encounter a new wallet, i.e., wallet for whose we haven&#x27;t yet computed value lost, we call `sumWalletBets` on it.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      getBalanceDiff </span><span style="color:var(--shiki-token-constant)">[]</span><span style="color:var(--shiki-color-text)"> _set acc </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> acc</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      getBalanceDiff wlBets</span><span style="color:var(--shiki-token-keyword)">@</span><span style="color:var(--shiki-color-text)">((getWallet</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> _dat</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> _bet) </span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> remWalletBets) set acc </span><span style="color:var(--shiki-token-keyword)">=</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">let</span><span style="color:var(--shiki-color-text)"> wallet </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> getWallet ws</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            wallet&#x27;sName </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> walletName wallet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">in</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> Set.member wallet&#x27;sName set </span><span style="color:var(--shiki-token-keyword)">then</span><span style="color:var(--shiki-color-text)"> getBalanceDiff remWalletBets set acc</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-keyword)">else</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">           getBalanceDiff remWalletBets (Set.insert wallet&#x27;sName set) ((wallet </span><span style="color:var(--shiki-token-keyword)">:=</span><span style="color:var(--shiki-color-text)"> sumWalletBets wallet wlBets mempty) </span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> acc)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      balanceDiffWithoutFees </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> getBalanceDiff walletBets Set.empty </span><span style="color:var(--shiki-token-constant)">[]</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  balanceBeforeAllTheseOps </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> fmap fromJust </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> runWallet w1 </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> traverse (</span><span style="color:var(--shiki-token-keyword)">\</span><span style="color:var(--shiki-color-text)">(wallet</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> _value) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> balance wallet) balanceDiffWithoutFees</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  performBetOperations walletBets True</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  balanceAfterAllTheseOps </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> fmap fromJust </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> runWallet w1 </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> traverse (</span><span style="color:var(--shiki-token-keyword)">\</span><span style="color:var(--shiki-color-text)">(wallet</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> _value) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> balance wallet) balanceDiffWithoutFees</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  void </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> runWallet w1 </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> verify (zip3 balanceDiffWithoutFees balanceBeforeAllTheseOps balanceAfterAllTheseOps)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">where</span></span>
<span class="line"><span style="color:var(--shiki-token-comment)">    -- | Function to verify that the wallet indeed lost by /roughly/ the bet amount. We say /roughly/ as fees is assumed to be within (0, 1 ada].</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    verify </span><span style="color:var(--shiki-token-constant)">[]</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> return </span><span style="color:var(--shiki-token-constant)">()</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    verify (((wallet</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> diff)</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> vBefore</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> vAfter) </span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> xs) </span><span style="color:var(--shiki-token-keyword)">=</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">let</span><span style="color:var(--shiki-color-text)"> vAfterWithoutFees </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> vBefore </span><span style="color:var(--shiki-token-keyword)">&lt;&gt;</span><span style="color:var(--shiki-color-text)"> diff</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          (expectedAdaWithoutFees</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> expectedOtherAssets) </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> valueSplitAda vAfterWithoutFees</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          (actualAda</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> actualOtherAssets) </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> valueSplitAda vAfter</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          </span><span style="color:var(--shiki-token-comment)">-- threshold = valueFromLovelace 1_000_000  -- 1 ada</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">          threshold </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">1_000_000</span><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- 1 ada</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">in</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> expectedOtherAssets </span><span style="color:var(--shiki-token-keyword)">==</span><span style="color:var(--shiki-color-text)"> actualOtherAssets </span><span style="color:var(--shiki-token-keyword)">&amp;&amp;</span><span style="color:var(--shiki-color-text)"> actualAda </span><span style="color:var(--shiki-token-keyword)">&lt;</span><span style="color:var(--shiki-color-text)"> expectedAdaWithoutFees </span><span style="color:var(--shiki-token-keyword)">&amp;&amp;</span><span style="color:var(--shiki-color-text)"> expectedAdaWithoutFees </span><span style="color:var(--shiki-token-keyword)">-</span><span style="color:var(--shiki-color-text)"> threshold </span><span style="color:var(--shiki-token-keyword)">&lt;=</span><span style="color:var(--shiki-color-text)"> actualAda </span><span style="color:var(--shiki-token-keyword)">then</span><span style="color:var(--shiki-color-text)"> verify xs</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">             </span><span style="color:var(--shiki-token-comment)">-- valueGreater vAfterWithoutFees vAfter &amp;&amp; valueGreaterOrEqual vAfter (valueMinus vAfterWithoutFees threshold) then verify xs</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">         </span><span style="color:var(--shiki-token-keyword)">else</span><span style="color:var(--shiki-color-text)"> fail (</span><span style="color:var(--shiki-token-string-expression)">&quot;For wallet &quot;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&gt;</span><span style="color:var(--shiki-color-text)"> walletName wallet </span><span style="color:var(--shiki-token-keyword)">&lt;&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot; expected value (without fees) &quot;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&gt;</span><span style="color:var(--shiki-color-text)"> show vAfterWithoutFees </span><span style="color:var(--shiki-token-keyword)">&lt;&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot; but actual is &quot;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">&lt;&gt;</span><span style="color:var(--shiki-color-text)"> show vAfter)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-orange-100 nx-bg-orange-50 nx-text-orange-800 dark:nx-border-orange-400/30 dark:nx-bg-orange-400/20 dark:nx-text-orange-300"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;">💡</div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">An eagle eye might notice two comments inside the <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">verify</code> function.</p><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Firstly, note that <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">valueSplitAda</code> splits our <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GYValue</code> into lovelaces and that which remains besides it. Since fees don&#x27;t affect non-ada tokens (not yet), we compare with respect to threshold using ada tokens.</p><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">We could also compare <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">GYValue</code>&#x27;s directly using <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">valueGreater</code> (there is also <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">valueGreaterOrEqual</code>) as done in comments but the current one is slightly more optimal as we need not compare on non-ada tokens again.</p></div></div>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">But sometimes we want a test to fail!<a href="#but-sometimes-we-want-a-test-to-fail" id="but-sometimes-we-want-a-test-to-fail" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">What happens if the newly placed bet is not more than atleast <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpBetStep</code> amount? What happens if the transaction skeleton was somewhat wrong, say we didn&#x27;t put <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">mustBeSignedBy</code>? What if someone tries to place a bet after <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">brpBetUntil</code>? What if...</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Well for all such cases, we can assert that a given trace must fail using <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">mustFail</code> like:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="text" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="text" data-theme="default"><span class="line"><span style="color:var(--shiki-color-text)">testRun &quot;Not adding atleast bet step amount should fail&quot; $ mustFail . multipleBetsTrace 400 1000 (valueFromLovelace 10_000_000) </span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  [ (w1, OracleAnswerDatum 1, valueFromLovelace 10_000_000)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , (w2, OracleAnswerDatum 2, valueFromLovelace 20_000_000)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , (w3, OracleAnswerDatum 3, valueFromLovelace 30_000_000)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , (w2, OracleAnswerDatum 4, valueFromLovelace 50_000_000)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  , (w4, OracleAnswerDatum 5, valueFromLovelace 55_000_000 &lt;&gt; fakeGold 1000)]</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Here wallet <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">w4</code> didn&#x27;t increase the bet by 10 ada and thus must fail.</p>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-orange-100 nx-bg-orange-50 nx-text-orange-800 dark:nx-border-orange-400/30 dark:nx-bg-orange-400/20 dark:nx-text-orange-300"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;">💡</div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Sometimes we want to assert specific failure among other possible failures. As <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">mustFail</code> above doesn&#x27;t distinguish among them, one can simply use <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">catchError</code> like in <a href="https://github.com/geniusyield/atlas/tree/main/tests/GeniusYield/Test/RefInput.hs" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">this<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> test.</p></div></div>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Unit tests for taking the bet pot<a href="#unit-tests-for-taking-the-bet-pot" id="unit-tests-for-taking-the-bet-pot" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<div class="nextra-callout nx-overflow-x-auto nx-mt-6 nx-flex nx-rounded-lg nx-border nx-py-2 ltr:nx-pr-4 rtl:nx-pl-4 contrast-more:nx-border-current contrast-more:dark:nx-border-current nx-border-yellow-100 nx-bg-yellow-50 nx-text-yellow-900 dark:nx-border-yellow-200/30 dark:nx-bg-yellow-700/30 dark:nx-text-yellow-200"><div class="nx-select-none nx-text-xl ltr:nx-pl-3 ltr:nx-pr-2 rtl:nx-pr-3 rtl:nx-pl-2" style="font-family:&quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;">📃</div><div class="nx-w-full nx-min-w-0 nx-leading-7"><p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Entire code file for tests pertaining to this operation is available <a href="https://github.com/geniusyield/atlas-examples/tree/main/bet-ref/tests/BetRef/Tests/TakeBetPot.hs" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">here<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a>.</p></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">On similar lines as before, let&#x27;s first define our <em>run</em> for <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">takeBets</code> operation:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">-- | Run to call the `takeBets` operation.</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">takeBetsRun</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxOutRef</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">BetRefParams</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxOutRef</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxOutRef</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxMonadRun</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxId</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">takeBetsRun refScript brp toConsume refInput </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  addr </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> ownAddress</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  skeleton </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> takeBets refScript brp toConsume addr refInput</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  sendSkeleton skeleton</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Next, we&#x27;ll define our trace to call this <em>run</em>:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">-- | Trace for taking bet pot.</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">takeBetsTrace</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Integer</span><span style="color:var(--shiki-color-text)">                                            </span><span style="color:var(--shiki-token-comment)">-- ^ slot for betUntil</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">              </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Integer</span><span style="color:var(--shiki-color-text)">                                            </span><span style="color:var(--shiki-token-comment)">-- ^ slot for betReveal</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">              </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYValue</span><span style="color:var(--shiki-color-text)">                                            </span><span style="color:var(--shiki-token-comment)">-- ^ bet step</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">              </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> [(</span><span style="color:var(--shiki-token-keyword)">Wallets</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Wallet</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">OracleAnswerDatum</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYValue</span><span style="color:var(--shiki-color-text)">)]  </span><span style="color:var(--shiki-token-comment)">-- ^ List denoting the bets</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">              </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Integer</span><span style="color:var(--shiki-color-text)">                                            </span><span style="color:var(--shiki-token-comment)">-- ^ Actual answer</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">              </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">Wallets</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Wallet</span><span style="color:var(--shiki-color-text)">)                                </span><span style="color:var(--shiki-token-comment)">-- ^ Taker</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">              </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Bool</span><span style="color:var(--shiki-color-text)">                                               </span><span style="color:var(--shiki-token-comment)">-- ^ To check balance</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">              </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Wallets</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Run</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">()</span><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- Our continuation function</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">takeBetsTrace betUntil&#x27; betReveal&#x27; betStep walletBets answer getTaker toCheckBalance ws</span><span style="color:var(--shiki-token-keyword)">@</span><span style="color:var(--shiki-color-text)">Wallets{..} </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  (brp</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> refScript) </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> computeParamsAndAddRefScript betUntil&#x27; betReveal&#x27; betStep ws</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  multipleBetsTraceCore brp refScript walletBets ws</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- Now lets take the bet</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  mMRef </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> runWallet w1 </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> addRefInput True (walletAddress w8) (datumFromPlutusData </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> OracleAnswerDatum answer)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">let</span><span style="color:var(--shiki-color-text)"> taker </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> getTaker ws</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">case</span><span style="color:var(--shiki-color-text)"> mMRef </span><span style="color:var(--shiki-token-keyword)">of</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    Just (Just refInput) </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      void </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> runWallet taker </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        betRefAddr </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> betRefAddress brp</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        [_scriptUtxo</span><span style="color:var(--shiki-token-keyword)">@</span><span style="color:var(--shiki-color-text)">GYUTxO {utxoRef, utxoValue}] </span><span style="color:var(--shiki-token-keyword)">&lt;-</span><span style="color:var(--shiki-color-text)"> utxosToList </span><span style="color:var(--shiki-token-keyword)">&lt;$&gt;</span><span style="color:var(--shiki-color-text)"> utxosAtAddress betRefAddr Nothing</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        waitUntilSlot </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> slotFromApi (fromInteger betReveal&#x27;)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        (</span><span style="color:var(--shiki-token-keyword)">if</span><span style="color:var(--shiki-color-text)"> toCheckBalance </span><span style="color:var(--shiki-token-keyword)">then</span><span style="color:var(--shiki-color-text)"> withWalletBalancesCheckSimple [taker </span><span style="color:var(--shiki-token-keyword)">:=</span><span style="color:var(--shiki-color-text)"> utxoValue] </span><span style="color:var(--shiki-token-keyword)">$</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">do</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            takeBetsRun refScript brp utxoRef refInput </span><span style="color:var(--shiki-token-keyword)">else</span><span style="color:var(--shiki-color-text)"> takeBetsRun refScript brp utxoRef refInput)</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    _anyOtherMatch </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> fail </span><span style="color:var(--shiki-token-string-expression)">&quot;Couldn&#x27;t place reference input successfully&quot;</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Here we first did the common step of computing the required script parameters and adding the reference script.</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Then we used <a href="https://haddock.atlas-app.io/GeniusYield-Test-Utils.html#v:addRefInput" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">addRefInput</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> whose purpose here would become clear by seeing its haddock documentation below:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-comment)">-- | Adds an input (whose datum we&#x27;ll refer later) and returns the reference to it.</span></span>
<span class="line"><span style="color:var(--shiki-token-function)">addRefInput</span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">Bool</span><span style="color:var(--shiki-color-text)">       </span><span style="color:var(--shiki-token-comment)">-- ^ Whether to inline this datum?</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">           </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYAddress</span><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">-- ^ Where to place this output?</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">           </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYDatum</span><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)">-- ^ Our datum.</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">           </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxMonadRun</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-keyword)">Maybe</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">GYTxOutRef</span><span style="color:var(--shiki-color-text)">)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Next we simply wait until time for bet revealation and claim our pot!</p>
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Now that we have our trace for taking bet pot, we can try testing for other conditions - examples for some are written in the <a href="https://github.com/geniusyield/atlas-examples/tree/main/bet-ref/tests/BetRef/Tests/TakeBetPot.hs" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">TakeBetPot.hs</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> file.</p>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="nx-sr-only">Footnotes<a href="#footnote-label" id="footnote-label" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2" id="user-content-fn-1">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">We use a <a href="https://github.com/geniusyield/plutus-simple-model/tree/compat" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">custom fork<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> of Plutus simple model. <a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font] data-footnote-backref" data-footnote-backref="true" aria-label="Back to content" href="/getting-started/unit-tests#user-content-fnref-1">↩</a></p>
</li>
<li class="nx-my-2" id="user-content-fn-2">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">To convey the message better, we have a defined <a href="https://haddock.atlas-app.io/GeniusYield-Test-Utils.html#v::-61-" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">(:=)</code><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> pattern synonym:</p>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="haskell" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="haskell" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">pattern</span><span style="color:var(--shiki-color-text)"> (:=) </span><span style="color:var(--shiki-token-keyword)">::</span><span style="color:var(--shiki-color-text)"> x </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> y </span><span style="color:var(--shiki-token-keyword)">-&gt;</span><span style="color:var(--shiki-color-text)"> (x</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> y)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">pattern</span><span style="color:var(--shiki-color-text)"> (</span><span style="color:var(--shiki-token-function)">:=</span><span style="color:var(--shiki-color-text)">) x y </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-color-text)"> (x</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-color-text)"> y)</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50" title="Copy code" tabindex="0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" class="nextra-copy-icon nx-pointer-events-none nx-h-4 nx-w-4"><rect x="9" y="9" width="13" height="13" rx="2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>
<a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font] data-footnote-backref" data-footnote-backref="true" aria-label="Back to content" href="/getting-started/unit-tests#user-content-fnref-2">↩</a>
</li>
<li class="nx-my-2" id="user-content-fn-3">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">Since we require the signature being present in the skeleton, we can&#x27;t place bet on anyone else&#x27;s behalf anyways. <a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font] data-footnote-backref" data-footnote-backref="true" aria-label="Back to content" href="/getting-started/unit-tests#user-content-fnref-3">↩</a></p>
</li>
<li class="nx-my-2" id="user-content-fn-4">
<p class="nx-mt-6 nx-leading-7 first:nx-mt-0">If you would like exact fine grained control over balance change, use <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">withWalletBalancesCheck</code> instead. <a class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font] data-footnote-backref" data-footnote-backref="true" aria-label="Back to content" href="/getting-started/unit-tests#user-content-fnref-4">↩</a></p>
</li>
</ol>
</section><div class="nx-mt-16"></div><div class="nx-mb-8 nx-flex nx-items-center nx-border-t nx-pt-8 dark:nx-border-neutral-800 contrast-more:nx-border-neutral-400 dark:contrast-more:nx-border-neutral-400 print:nx-hidden"><a title="Operations over Contract" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-pr-4 rtl:nx-pl-4" href="/getting-started/operations"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 ltr:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>Operations over Contract</a><a title="Integration Tests" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-ml-auto ltr:nx-pl-4 ltr:nx-text-right rtl:nx-mr-auto rtl:nx-pr-4 rtl:nx-text-left" href="/getting-started/integration-tests">Integration Tests<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 rtl:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></a></div></main></article></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{}},"page":"/getting-started/unit-tests","query":{},"buildId":"1Xa-Stng7ls29pFVyzeKI","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>